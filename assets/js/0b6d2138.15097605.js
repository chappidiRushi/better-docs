"use strict";(globalThis.webpackChunkbetter_docs=globalThis.webpackChunkbetter_docs||[]).push([[3213],{1322(n,e,s){s.r(e),s.d(e,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"mongo/mongodb-transactions-consistency","title":"Transactions and Consistency","description":"----------------","source":"@site/docs/mongo/Transactions and consistency.md","sourceDirName":"mongo","slug":"/mongo/mongodb-transactions-consistency","permalink":"/better-docs/docs/mongo/mongodb-transactions-consistency","draft":false,"unlisted":false,"editUrl":"https://github.com/chappidirushi/better-docs/tree/main/docs/mongo/Transactions and consistency.md","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"id":"mongodb-transactions-consistency","title":"Transactions and Consistency","sidebar_position":9},"sidebar":"tutorialSidebar","previous":{"title":"Aggregation Framework","permalink":"/better-docs/docs/mongo/mongodb-aggregation-framework"},"next":{"title":"Replication","permalink":"/better-docs/docs/mongo/mongodb-replication"}}');var t=s(4848),o=s(8453);const r={id:"mongodb-transactions-consistency",title:"Transactions and Consistency",sidebar_position:9},c=void 0,l={},a=[{value:"Single-Document Atomicity",id:"single-document-atomicity",level:2},{value:"Multi-Document Transactions",id:"multi-document-transactions",level:2},{value:"Sessions",id:"sessions",level:2},{value:"Retryable Writes",id:"retryable-writes",level:2},{value:"Transaction Limits",id:"transaction-limits",level:2},{value:"Performance Implications",id:"performance-implications",level:2},{value:"Notes",id:"notes",level:2},{value:"Caveats",id:"caveats",level:2}];function d(n){const e={blockquote:"blockquote",code:"code",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...n.components},{Details:s}=e;return s||function(n,e){throw new Error("Expected "+(e?"component":"object")+" `"+n+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.h2,{id:"single-document-atomicity",children:"Single-Document Atomicity"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"Operations on a single document are atomic by default"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Interview points"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Applies to insert, update, delete"}),"\n",(0,t.jsx)(e.li,{children:"Covers embedded documents"}),"\n",(0,t.jsx)(e.li,{children:"No partial updates"}),"\n"]}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Examples (Node.js)"}),(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:"// Atomic update on single document\nawait db.collection('accounts').updateOne(\n  { _id: 1 },\n  { $inc: { balance: -100 }, $set: { updatedAt: new Date() } }\n);\n"})})]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"multi-document-transactions",children:"Multi-Document Transactions"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"ACID transactions across multiple documents and collections"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Interview points"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Requires replica set or sharded cluster"}),"\n",(0,t.jsx)(e.li,{children:"Snapshot isolation"}),"\n",(0,t.jsx)(e.li,{children:"All-or-nothing commit"}),"\n"]}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Examples (Node.js)"}),(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:"const session = client.startSession();\n\ntry {\n  session.startTransaction();\n\n  await db.collection('accounts').updateOne(\n    { _id: 1 },\n    { $inc: { balance: -100 } },\n    { session }\n  );\n\n  await db.collection('accounts').updateOne(\n    { _id: 2 },\n    { $inc: { balance: 100 } },\n    { session }\n  );\n\n  await session.commitTransaction();\n} catch (e) {\n  await session.abortTransaction();\n} finally {\n  await session.endSession();\n}\n"})})]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"sessions",children:"Sessions"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"Logical context for causal consistency and transactions"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Interview points"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Required for transactions"}),"\n",(0,t.jsx)(e.li,{children:"Enables causal ordering"}),"\n",(0,t.jsx)(e.li,{children:"Lightweight and client-managed"}),"\n"]}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Examples (Node.js)"}),(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:"const session = client.startSession({ causalConsistency: true });\n\nawait db.collection('users').findOne({ _id: 1 }, { session });\n\nsession.endSession();\n"})})]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"retryable-writes",children:"Retryable Writes"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"Automatic retry of certain write operations"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Interview points"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Enabled by default in drivers"}),"\n",(0,t.jsx)(e.li,{children:"Prevents duplicate writes"}),"\n",(0,t.jsxs)(e.li,{children:["Requires ",(0,t.jsx)(e.code,{children:"_id"})]}),"\n"]}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Examples (Node.js)"}),(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:"const client = new MongoClient(uri, {\n  retryWrites: true // boolean\n});\n\nawait db.collection('logs').insertOne({ _id: 'x1', msg: 'ok' });\n"})})]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"transaction-limits",children:"Transaction Limits"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"Hard limits enforced by the server"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Interview points"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"60 seconds lifetime"}),"\n",(0,t.jsx)(e.li,{children:"100MB oplog entry limit"}),"\n",(0,t.jsx)(e.li,{children:"No long-running transactions"}),"\n"]}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Examples (Node.js)"}),(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:"session.startTransaction({\n  readConcern: { level: 'snapshot' }, // local | majority | snapshot\n  writeConcern: { w: 'majority' },     // number | 'majority'\n  readPreference: 'primary'            // primary only\n});\n"})})]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"performance-implications",children:"Performance Implications"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"Cost of transactional guarantees"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Interview points"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Slower than single-document ops"}),"\n",(0,t.jsx)(e.li,{children:"Locks and retries"}),"\n",(0,t.jsx)(e.li,{children:"Increased memory and oplog usage"}),"\n"]}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Examples (Node.js)"}),(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:"// Prefer atomic single-document model\nawait db.collection('orders').updateOne(\n  { _id: 1, status: 'pending' },\n  { $set: { status: 'paid' } }\n);\n\n// Avoid transaction if possible\n"})})]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"notes",children:"Notes"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Model data to avoid transactions"}),"\n",(0,t.jsx)(e.li,{children:"Single-document atomicity is fastest"}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"caveats",children:"Caveats"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Transactions reduce throughput"}),"\n",(0,t.jsx)(e.li,{children:"Poor schema design forces transactions"}),"\n",(0,t.jsx)(e.li,{children:"Not supported on standalone servers"}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(d,{...n})}):d(n)}},8453(n,e,s){s.d(e,{R:()=>r,x:()=>c});var i=s(6540);const t={},o=i.createContext(t);function r(n){const e=i.useContext(o);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:r(n.components),i.createElement(o.Provider,{value:e},n.children)}}}]);