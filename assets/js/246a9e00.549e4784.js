"use strict";(globalThis.webpackChunkbetter_docs=globalThis.webpackChunkbetter_docs||[]).push([[3196],{3283(r,e,n){n.r(e),n.d(e,{assets:()=>l,contentTitle:()=>t,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"mongo/mongoose-error-handling","title":"Error Handling","description":"-----------------","source":"@site/docs/mongo/Mongoose Errors.md","sourceDirName":"mongo","slug":"/mongo/mongoose-error-handling","permalink":"/better-docs/docs/mongo/mongoose-error-handling","draft":false,"unlisted":false,"editUrl":"https://github.com/chappidirushi/better-docs/tree/main/docs/mongo/Mongoose Errors.md","tags":[],"version":"current","sidebarPosition":38,"frontMatter":{"id":"mongoose-error-handling","title":"Error Handling","sidebar_position":38},"sidebar":"tutorialSidebar","previous":{"title":"Serialization and Output","permalink":"/better-docs/docs/mongo/mongoose-serialization-output"},"next":{"title":"Performance and Optimization","permalink":"/better-docs/docs/mongo/mongoose-performance-optimization"}}');var s=n(4848),a=n(8453);const i={id:"mongoose-error-handling",title:"Error Handling",sidebar_position:38},t=void 0,l={},c=[{value:"1. Error Hierarchy",id:"1-error-hierarchy",level:2},{value:"2. Cast Errors",id:"2-cast-errors",level:2},{value:"3. Validation Errors",id:"3-validation-errors",level:2},{value:"4. MongoDB Server Errors",id:"4-mongodb-server-errors",level:2},{value:"5. Error Normalization",id:"5-error-normalization",level:2},{value:"Notes",id:"notes",level:2},{value:"Caveats",id:"caveats",level:2}];function d(r){const e={blockquote:"blockquote",code:"code",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...r.components},{Details:n}=e;return n||function(r,e){throw new Error("Expected "+(e?"component":"object")+" `"+r+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h2,{id:"1-error-hierarchy",children:"1. Error Hierarchy"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsxs)(e.p,{children:["All Mongoose errors extend ",(0,s.jsx)(e.code,{children:"MongooseError"})]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"MongooseError\n \u251c\u2500 CastError\n \u251c\u2500 ValidationError\n \u251c\u2500 VersionError\n \u251c\u2500 DocumentNotFoundError\n \u2514\u2500 MongoServerError (wrapped)\n"})}),"\n",(0,s.jsxs)(n,{children:[(0,s.jsx)("summary",{children:"Examples"}),(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"try {\n  await User.findById('invalid');\n} catch (err) {\n  err instanceof mongoose.Error;              // true\n  err.name;                                   // string\n  err.message;                                // string\n}\n"})})]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"2-cast-errors",children:"2. Cast Errors"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"Thrown when value cannot be cast to schema type"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"CastError { path, value, kind, reason }\n"})}),"\n",(0,s.jsxs)(n,{children:[(0,s.jsx)("summary",{children:"Examples"}),(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"try {\n  await User.findById('abc');                  // invalid ObjectId\n} catch (err) {\n  err.name === 'CastError';                    // true\n  err.path;                                   // '_id'\n  err.kind;                                   // 'ObjectId'\n  err.value;                                  // 'abc'\n}\n"})})]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"3-validation-errors",children:"3. Validation Errors"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"Aggregated errors from schema validation failures"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"ValidationError { errors: { [path]: ValidatorError } }\n"})}),"\n",(0,s.jsxs)(n,{children:[(0,s.jsx)("summary",{children:"Examples"}),(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"try {\n  await User.create({ email: 'not-an-email' });\n} catch (err) {\n  err.name === 'ValidationError';              // true\n  Object.keys(err.errors);                     // ['email']\n\n  err.errors.email.kind;                       // 'regexp' | 'required' | 'min'\n  err.errors.email.message;                    // string\n}\n"})})]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"4-mongodb-server-errors",children:"4. MongoDB Server Errors"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"Errors returned directly from MongoDB server"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"MongoServerError { code, keyPattern, keyValue }\n"})}),"\n",(0,s.jsxs)(n,{children:[(0,s.jsx)("summary",{children:"Examples"}),(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"try {\n  await User.create({ email: 'a@test.com' });\n  await User.create({ email: 'a@test.com' }); // duplicate\n} catch (err) {\n  err.name === 'MongoServerError';             // true\n  err.code === 11000;                          // duplicate key\n  err.keyPattern;                             // { email: 1 }\n  err.keyValue;                               // { email: 'a@test.com' }\n}\n"})})]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"5-error-normalization",children:"5. Error Normalization"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"Convert heterogeneous errors into consistent application-level format"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"normalize(err) \u2192 { type, message, details }\n"})}),"\n",(0,s.jsxs)(n,{children:[(0,s.jsx)("summary",{children:"Examples"}),(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"function normalizeError(err) {\n  if (err instanceof mongoose.Error.CastError) {\n    return { type: 'CAST', message: 'Invalid ID', details: err.path };\n  }\n\n  if (err instanceof mongoose.Error.ValidationError) {\n    return {\n      type: 'VALIDATION',\n      message: 'Validation failed',\n      details: Object.values(err.errors).map(e => e.message)\n    };\n  }\n\n  if (err.code === 11000) {\n    return {\n      type: 'DUPLICATE',\n      message: 'Duplicate key',\n      details: err.keyValue\n    };\n  }\n\n  return { type: 'UNKNOWN', message: err.message };\n}\n"})})]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"notes",children:"Notes"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Mongoose wraps MongoDB driver errors"}),"\n",(0,s.jsx)(e.li,{children:"Validation errors can contain multiple field failures"}),"\n",(0,s.jsxs)(e.li,{children:["Error ",(0,s.jsx)(e.code,{children:"name"})," is more stable than message"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"caveats",children:"Caveats"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Lean queries still throw MongoDB errors"}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"updateOne"})," validation errors require ",(0,s.jsx)(e.code,{children:"runValidators"})]}),"\n",(0,s.jsx)(e.li,{children:"Network errors bypass Mongoose abstractions"}),"\n"]})]})}function h(r={}){const{wrapper:e}={...(0,a.R)(),...r.components};return e?(0,s.jsx)(e,{...r,children:(0,s.jsx)(d,{...r})}):d(r)}},8453(r,e,n){n.d(e,{R:()=>i,x:()=>t});var o=n(6540);const s={},a=o.createContext(s);function i(r){const e=o.useContext(a);return o.useMemo(function(){return"function"==typeof r?r(e):{...e,...r}},[e,r])}function t(r){let e;return e=r.disableParentContext?"function"==typeof r.components?r.components(s):r.components||s:i(r.components),o.createElement(a.Provider,{value:e},r.children)}}}]);