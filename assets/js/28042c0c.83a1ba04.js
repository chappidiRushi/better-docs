"use strict";(globalThis.webpackChunkbetter_docs=globalThis.webpackChunkbetter_docs||[]).push([[1467],{8453(e,n,s){s.d(n,{R:()=>o,x:()=>l});var i=s(6540);const t={},r=i.createContext(t);function o(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(r.Provider,{value:n},e.children)}},9400(e,n,s){s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"mongo/mongoose-documents","title":"Mongoose Documents","description":"-----------------","source":"@site/docs/mongo/Mongoose Documents.md","sourceDirName":"mongo","slug":"/mongo/mongoose-documents","permalink":"/better-docs/docs/mongo/mongoose-documents","draft":false,"unlisted":false,"editUrl":"https://github.com/chappidirushi/better-docs/tree/main/docs/mongo/Mongoose Documents.md","tags":[],"version":"current","sidebarPosition":27,"frontMatter":{"id":"mongoose-documents","title":"Mongoose Documents","sidebar_position":27},"sidebar":"tutorialSidebar","previous":{"title":"Mongoose Models and Compilation","permalink":"/better-docs/docs/mongo/mongoose-models-compilation"},"next":{"title":"Mongoose Validation System","permalink":"/better-docs/docs/mongo/mongoose-validation"}}');var t=s(4848),r=s(8453);const o={id:"mongoose-documents",title:"Mongoose Documents",sidebar_position:27},l=void 0,d={},c=[{value:"Document Instantiation",id:"document-instantiation",level:2},{value:"Change Tracking",id:"change-tracking",level:2},{value:"Dirty Checking",id:"dirty-checking",level:2},{value:"Virtuals",id:"virtuals",level:2},{value:"Getters and Setters",id:"getters-and-setters",level:2},{value:"Lean Documents",id:"lean-documents",level:2},{value:"Hydration",id:"hydration",level:2},{value:"Notes",id:"notes",level:2},{value:"Caveats",id:"caveats",level:2}];function a(e){const n={blockquote:"blockquote",code:"code",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"document-instantiation",children:"Document Instantiation"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Creating document instances before persistence"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Instantiated via model constructor"}),"\n",(0,t.jsx)(n.li,{children:"Exists only in memory until saved"}),"\n",(0,t.jsx)(n.li,{children:"Defaults applied at creation time"}),"\n"]}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Examples (Node.js)"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"const user = new User({ name: 'Alice', age: 30 });\n\nuser.isNew; // true\n"})})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"change-tracking",children:"Change Tracking"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Internal bookkeeping of modified paths"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Tracks field-level mutations"}),"\n",(0,t.jsx)(n.li,{children:"Enables minimal updates"}),"\n",(0,t.jsx)(n.li,{children:"Reset after successful save"}),"\n"]}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Examples (Node.js)"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"user.name = 'Bob';\n\nuser.modifiedPaths(); // ['name']\n"})})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"dirty-checking",children:"Dirty Checking"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Detecting unsaved changes in documents"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Performed client-side"}),"\n",(0,t.jsx)(n.li,{children:"Used to generate update operators"}),"\n",(0,t.jsx)(n.li,{children:"Can be manually overridden"}),"\n"]}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Examples (Node.js)"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"user.isModified('name'); // true | false\n\nuser.markModified('meta'); // for Mixed types\n"})})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"virtuals",children:"Virtuals"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Computed properties not persisted to MongoDB"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Derived fields"}),"\n",(0,t.jsx)(n.li,{children:"Included optionally in JSON/Object output"}),"\n",(0,t.jsx)(n.li,{children:"Zero storage cost"}),"\n"]}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Examples (Node.js)"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"userSchema.virtual('isAdult').get(function () {\n  return this.age >= 18;\n});\n\nuser.isAdult; // computed\n"})})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"getters-and-setters",children:"Getters and Setters"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Transforming values on read and write"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Applied during casting and retrieval"}),"\n",(0,t.jsx)(n.li,{children:"Does not affect stored value directly"}),"\n",(0,t.jsx)(n.li,{children:"Can hide data inconsistencies"}),"\n"]}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Examples (Node.js)"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"const schema = new mongoose.Schema({\n  email: {\n    type: String,\n    set: v => v.toLowerCase(), // setter\n    get: v => v.toUpperCase(), // getter\n  }\n});\n"})})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"lean-documents",children:"Lean Documents"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Skipping document hydration for performance"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Returns plain JS objects"}),"\n",(0,t.jsx)(n.li,{children:"No getters, setters, or methods"}),"\n",(0,t.jsx)(n.li,{children:"Preferred for read-heavy paths"}),"\n"]}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Examples (Node.js)"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"await User.findOne({ name: 'Alice' }).lean(); // plain object\n"})})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"hydration",children:"Hydration"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Converting raw MongoDB results into Mongoose documents"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Automatic for normal queries"}),"\n",(0,t.jsx)(n.li,{children:"Expensive at scale"}),"\n",(0,t.jsx)(n.li,{children:"Avoidable via lean"}),"\n"]}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Examples (Node.js)"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// Manual hydration\nconst raw = await db.collection('users').findOne({});\nconst doc = User.hydrate(raw);\n"})})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Documents encapsulate state + behavior"}),"\n",(0,t.jsx)(n.li,{children:"Hydration is the main performance cost"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"caveats",children:"Caveats"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Overusing documents hurts throughput"}),"\n",(0,t.jsx)(n.li,{children:"Lean queries bypass validation and hooks"}),"\n",(0,t.jsx)(n.li,{children:"Virtuals can mask missing data"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}}}]);