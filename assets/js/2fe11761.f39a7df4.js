"use strict";(globalThis.webpackChunkbetter_docs=globalThis.webpackChunkbetter_docs||[]).push([[4130],{6613(e,n,s){s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>u,frontMatter:()=>l,metadata:()=>t,toc:()=>r});const t=JSON.parse('{"id":"mongo/mongoose-delete-operations","title":"Delete Operations","description":"-----------------","source":"@site/docs/mongo/Mongoose Delete Operations.md","sourceDirName":"mongo","slug":"/mongo/mongoose-delete-operations","permalink":"/better-docs/docs/mongo/mongoose-delete-operations","draft":false,"unlisted":false,"editUrl":"https://github.com/chappidirushi/better-docs/tree/main/docs/mongo/Mongoose Delete Operations.md","tags":[],"version":"current","sidebarPosition":36,"frontMatter":{"id":"mongoose-delete-operations","title":"Delete Operations","sidebar_position":36},"sidebar":"tutorialSidebar","previous":{"title":"Transactions and Sessions","permalink":"/better-docs/docs/mongo/mongoose-transactions-sessions"},"next":{"title":"Serialization and Output","permalink":"/better-docs/docs/mongo/mongoose-serialization-output"}}');var o=s(4848),i=s(8453);const l={id:"mongoose-delete-operations",title:"Delete Operations",sidebar_position:36},d=void 0,a={},r=[{value:"1. Delete Methods",id:"1-delete-methods",level:2},{value:"2. Middleware Interaction",id:"2-middleware-interaction",level:2},{value:"3. Soft Deletes",id:"3-soft-deletes",level:2},{value:"4. Cascading Deletes",id:"4-cascading-deletes",level:2},{value:"Notes",id:"notes",level:2},{value:"Caveats",id:"caveats",level:2}];function c(e){const n={blockquote:"blockquote",code:"code",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"1-delete-methods",children:"1. Delete Methods"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Atomic delete APIs at model and document level"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"Model.deleteOne(filter, options?)        // \u2192 Promise<DeleteResult>\nModel.deleteMany(filter, options?)       // \u2192 Promise<DeleteResult>\nModel.findOneAndDelete(filter, options?) // \u2192 Promise<Document|null>\nDocument.deleteOne(options?)             // \u2192 Promise<DeleteResult>\n"})}),"\n",(0,o.jsxs)(s,{children:[(0,o.jsx)("summary",{children:"Examples"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"// deleteOne\nawait User.deleteOne(\n  { _id: id },                 // filter: object\n  { session }                  // options: session | collation\n);\n\n// deleteMany\nawait Session.deleteMany(\n  { expired: true },           // filter\n  { session }                  // options\n);\n\n// findOneAndDelete\nawait User.findOneAndDelete(\n  { email },\n  {\n    projection: { email: 1 },  // object | null\n    session                    // ClientSession\n  }\n);\n"})})]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"2-middleware-interaction",children:"2. Middleware Interaction"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Delete middleware differs by method and level"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"pre('deleteOne')\npre('deleteMany')\npre('findOneAndDelete')\n"})}),"\n",(0,o.jsxs)(s,{children:[(0,o.jsx)("summary",{children:"Examples"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"// Query middleware\nschema.pre('deleteOne', { document: false, query: true }, async function () {\n  // this = query\n});\n\nschema.pre('findOneAndDelete', async function () {\n  // this = query\n});\n\n// Document middleware\nschema.pre('deleteOne', { document: true }, async function () {\n  // this = document\n});\n"})})]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"3-soft-deletes",children:"3. Soft Deletes"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Logical deletion using flags instead of physical removal"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"{ deletedAt, isDeleted }\n"})}),"\n",(0,o.jsxs)(s,{children:[(0,o.jsx)("summary",{children:"Examples"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"// schema\nconst schema = new Schema({\n  deletedAt: Date,\n  isDeleted: { type: Boolean, default: false }\n});\n\n// soft delete\nawait User.updateOne(\n  { _id: id },\n  {\n    $set: {\n      isDeleted: true,\n      deletedAt: new Date()\n    }\n  }\n);\n\n// global query filter\nschema.pre(/^find/, function () {\n  this.where({ isDeleted: false });\n});\n"})})]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"4-cascading-deletes",children:"4. Cascading Deletes"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Manual or middleware-driven cleanup of dependent documents"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"// Application-level cascade\n"})}),"\n",(0,o.jsxs)(s,{children:[(0,o.jsx)("summary",{children:"Examples"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"// pre delete cascade\nschema.pre('findOneAndDelete', async function () {\n  const doc = await this.model.findOne(this.getQuery());\n\n  await Order.deleteMany({\n    userId: doc._id               // foreign key\n  });\n});\n\n// transactional cascade\nconst session = await mongoose.startSession();\n\nawait session.withTransaction(async () => {\n  await User.deleteOne({ _id: id }, { session });\n  await Order.deleteMany({ userId: id }, { session });\n});\n\nsession.endSession();\n"})})]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Deletes are atomic per document"}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"findOneAndDelete"})," returns the deleted document"]}),"\n",(0,o.jsx)(n.li,{children:"MongoDB has no native cascade delete"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"caveats",children:"Caveats"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"deleteMany"})," bypasses document middleware"]}),"\n",(0,o.jsx)(n.li,{children:"Soft deletes must be enforced at query level"}),"\n",(0,o.jsx)(n.li,{children:"Cascades should use transactions when consistency matters"}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453(e,n,s){s.d(n,{R:()=>l,x:()=>d});var t=s(6540);const o={},i=t.createContext(o);function l(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);