"use strict";(globalThis.webpackChunkbetter_docs=globalThis.webpackChunkbetter_docs||[]).push([[9660],{5459(e,n,s){s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>x,frontMatter:()=>t,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"mongo/mongoose-indexes","title":"Mongoose Indexes","description":"-----------------","source":"@site/docs/mongo/Mongoose Indexes.md","sourceDirName":"mongo","slug":"/mongo/mongoose-indexes","permalink":"/better-docs/docs/mongo/mongoose-indexes","draft":false,"unlisted":false,"editUrl":"https://github.com/chappidirushi/better-docs/tree/main/docs/mongo/Mongoose Indexes.md","tags":[],"version":"current","sidebarPosition":33,"frontMatter":{"id":"mongoose-indexes","title":"Mongoose Indexes","sidebar_position":33},"sidebar":"tutorialSidebar","previous":{"title":"Mongoose Aggregation","permalink":"/better-docs/docs/mongo/mongoose-aggregation"},"next":{"title":"Mongoose Updates and Atomic Operations","permalink":"/better-docs/docs/mongo/mongoose-updates-atomic"}}');var i=s(4848),r=s(8453);const t={id:"mongoose-indexes",title:"Mongoose Indexes",sidebar_position:33},d=void 0,a={},c=[{value:"1. Schema Index Definitions",id:"1-schema-index-definitions",level:2},{value:"2. Index Synchronization",id:"2-index-synchronization",level:2},{value:"3. Background Builds",id:"3-background-builds",level:2},{value:"4. Production Index Strategy",id:"4-production-index-strategy",level:2},{value:"Notes",id:"notes",level:2},{value:"Caveats",id:"caveats",level:2}];function l(e){const n={blockquote:"blockquote",code:"code",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"1-schema-index-definitions",children:"1. Schema Index Definitions"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Define indexes at schema level using ",(0,i.jsx)(n.code,{children:"index"}),", ",(0,i.jsx)(n.code,{children:"schema.index()"}),", or compound definitions"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"// Single-field, compound, unique, sparse, partial, TTL\n"})}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"Examples"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const UserSchema = new Schema({\n  email: {\n    type: String,\n    index: true,              // boolean | object\n    unique: true,             // boolean\n    sparse: true              // boolean\n  },\n  age: Number,\n  status: String,\n  createdAt: Date\n}, {\n  timestamps: true\n});\n\n// Compound index\nUserSchema.index(\n  { email: 1, status: 1 },     // 1 | -1 | 'text' | 'hashed'\n  { unique: true, background: true }\n);\n\n// Partial index\nUserSchema.index(\n  { age: 1 },\n  { partialFilterExpression: { age: { $gte: 18 } } }\n);\n\n// TTL index\nUserSchema.index(\n  { createdAt: 1 },\n  { expireAfterSeconds: 3600 } // seconds | 0\n);\n"})})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"2-index-synchronization",children:"2. Index Synchronization"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Sync schema-defined indexes with MongoDB using ",(0,i.jsx)(n.code,{children:"autoIndex"}),", ",(0,i.jsx)(n.code,{children:"syncIndexes"}),", or ",(0,i.jsx)(n.code,{children:"createIndexes"})]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"Model.syncIndexes(options?)     // \u2192 Promise<object>\nModel.createIndexes(options?)  // \u2192 Promise<void>\n"})}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"Examples"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"// Global\nmongoose.set('autoIndex', false); // boolean\n\n// Per schema\nnew Schema({}, { autoIndex: false }); // boolean\n\n// Runtime sync\nawait User.syncIndexes({\n  background: true,             // boolean\n  continueOnError: true         // boolean\n});\n\n// Explicit creation (no drop)\nawait User.createIndexes({\n  background: true              // boolean\n});\n"})})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"3-background-builds",children:"3. Background Builds"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Control index build behavior to avoid blocking writes"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"{ background: true }             // MongoDB < 4.2 relevant\n"})}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"Examples"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"// Schema-level\nUserSchema.index(\n  { email: 1 },\n  { background: true }          // boolean\n);\n\n// syncIndexes\nawait User.syncIndexes({\n  background: true              // boolean\n});\n\n// Note: MongoDB 4.2+ builds indexes in foreground by default without blocking\n"})})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"4-production-index-strategy",children:"4. Production Index Strategy"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Safe index management patterns for production systems"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"// Disable autoIndex, manage via migrations\n"})}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"Examples"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"// app bootstrap\nmongoose.set('autoIndex', false); // ALWAYS false in prod\n\n// CI / migration script\nawait User.syncIndexes({\n  background: true,\n  continueOnError: false\n});\n\n// Inspect\nawait User.collection.getIndexes(); // existing indexes\n\n// Drop manually if needed\nawait User.collection.dropIndex('email_1'); // string | object\n"})})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Schema indexes are declarative, DB indexes are imperative"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"syncIndexes"})," DROPS extra indexes not in schema"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"createIndexes"})," only creates missing ones"]}),"\n",(0,i.jsx)(n.li,{children:"Partial + compound indexes outperform sparse in most cases"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"caveats",children:"Caveats"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Never enable ",(0,i.jsx)(n.code,{children:"autoIndex"})," in production"]}),"\n",(0,i.jsx)(n.li,{children:"Index order matters in compound indexes"}),"\n",(0,i.jsxs)(n.li,{children:["TTL works only on ",(0,i.jsx)(n.code,{children:"Date"})," fields"]}),"\n",(0,i.jsx)(n.li,{children:"Text indexes are limited to one per collection"}),"\n"]})]})}function x(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453(e,n,s){s.d(n,{R:()=>t,x:()=>d});var o=s(6540);const i={},r=o.createContext(i);function t(e){const n=o.useContext(r);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);