"use strict";(globalThis.webpackChunkbetter_docs=globalThis.webpackChunkbetter_docs||[]).push([[6589],{8453(e,n,i){i.d(n,{R:()=>t,x:()=>c});var s=i(6540);const o={},l=s.createContext(o);function t(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),s.createElement(l.Provider,{value:n},e.children)}},8980(e,n,i){i.r(n),i.d(n,{assets:()=>r,contentTitle:()=>c,default:()=>m,frontMatter:()=>t,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"mongo/mongodb-documents-schema","title":"Documents, Collections, and Schema Design","description":"----------------","source":"@site/docs/mongo/Schema Design.md","sourceDirName":"mongo","slug":"/mongo/mongodb-documents-schema","permalink":"/better-docs/docs/mongo/mongodb-documents-schema","draft":false,"unlisted":false,"editUrl":"https://github.com/chappidirushi/better-docs/tree/main/docs/mongo/Schema Design.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"id":"mongodb-documents-schema","title":"Documents, Collections, and Schema Design","sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"BSON, Data Types, and Storage Model","permalink":"/better-docs/docs/mongo/mongodb-bson-storage"},"next":{"title":"CRUD Operations","permalink":"/better-docs/docs/mongo/mongodb-crud"}}');var o=i(4848),l=i(8453);const t={id:"mongodb-documents-schema",title:"Documents, Collections, and Schema Design",sidebar_position:4},c=void 0,r={},a=[{value:"Documents and Collections",id:"documents-and-collections",level:2},{value:"Dynamic Schema Implications",id:"dynamic-schema-implications",level:2},{value:"Embedding vs Referencing",id:"embedding-vs-referencing",level:2},{value:"Relationship Modeling Patterns",id:"relationship-modeling-patterns",level:2},{value:"Schema Evolution",id:"schema-evolution",level:2},{value:"Document Growth and Padding",id:"document-growth-and-padding",level:2},{value:"Namespace Management",id:"namespace-management",level:2},{value:"Notes",id:"notes",level:2},{value:"Caveats",id:"caveats",level:2}];function d(e){const n={blockquote:"blockquote",code:"code",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components},{Details:i}=n;return i||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"documents-and-collections",children:"Documents and Collections"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"BSON documents grouped into collections; no enforced schema"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Properties"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Document = atomic unit"}),"\n",(0,o.jsx)(n.li,{children:"Collection = namespace + indexes"}),"\n",(0,o.jsx)(n.li,{children:"Implicit collection creation"}),"\n"]}),"\n",(0,o.jsxs)(i,{children:[(0,o.jsx)("summary",{children:"Examples (Node.js)"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"import { MongoClient } from 'mongodb';\n\nconst client = new MongoClient(uri);\nawait client.connect();\nconst db = client.db('app');\n\n// Document insert\nawait db.collection('users').insertOne({ _id: 1, name: 'A', age: 30 });\n\n// Collection auto-created\nawait db.collection('orders').insertOne({ orderId: 'O1', total: 100 });\n\n// Explicit collection options\nawait db.createCollection('logs', {\n  capped: false,                  // boolean\n  validator: { $jsonSchema: { bsonType: 'object' } }, // object\n  validationLevel: 'strict',      // 'strict' | 'moderate'\n  validationAction: 'error'       // 'error' | 'warn'\n});\n"})})]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"dynamic-schema-implications",children:"Dynamic Schema Implications"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Schema-on-read with optional enforcement"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Implications"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Application-level validation required"}),"\n",(0,o.jsx)(n.li,{children:"Schema drift over time"}),"\n",(0,o.jsx)(n.li,{children:"Mixed-shape documents affect indexes"}),"\n"]}),"\n",(0,o.jsxs)(i,{children:[(0,o.jsx)("summary",{children:"Examples (Node.js)"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"// Same collection, different shapes\nawait db.collection('users').insertMany([\n  { _id: 1, name: 'A' },\n  { _id: 2, name: 'B', roles: ['admin'] },\n  { _id: 3, email: 'c@x.com' }\n]);\n\n// Add schema validation later\nawait db.command({\n  collMod: 'users',\n  validator: {\n    $jsonSchema: {\n      bsonType: 'object',\n      required: ['name'],\n      properties: {\n        name: { bsonType: 'string' },\n        roles: { bsonType: 'array' }\n      }\n    }\n  }\n});\n"})})]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"embedding-vs-referencing",children:"Embedding vs Referencing"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Read-path optimization vs write-time flexibility"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Embedding"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Single-document atomicity"}),"\n",(0,o.jsx)(n.li,{children:"Faster reads"}),"\n",(0,o.jsx)(n.li,{children:"Risk of document growth"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Referencing"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Independent lifecycle"}),"\n",(0,o.jsx)(n.li,{children:"Requires joins / extra queries"}),"\n"]}),"\n",(0,o.jsxs)(i,{children:[(0,o.jsx)("summary",{children:"Examples (Node.js)"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"// Embedding\nawait db.collection('orders').insertOne({\n  _id: 1,\n  user: { id: 10, name: 'Alex' },\n  items: [{ sku: 'P1', qty: 2 }]\n});\n\n// Referencing\nawait db.collection('orders').insertOne({ _id: 2, userId: 10 });\n\n// Join via aggregation lookup\nawait db.collection('orders').aggregate([\n  {\n    $lookup: {\n      from: 'users',\n      localField: 'userId',\n      foreignField: '_id',\n      as: 'user'\n    }\n  }\n]).toArray();\n"})})]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"relationship-modeling-patterns",children:"Relationship Modeling Patterns"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"One-to-one, one-to-many, many-to-many"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Common patterns"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"One-to-few \u2192 embed"}),"\n",(0,o.jsx)(n.li,{children:"One-to-many \u2192 bucket / subset"}),"\n",(0,o.jsx)(n.li,{children:"Many-to-many \u2192 referencing + lookup"}),"\n"]}),"\n",(0,o.jsxs)(i,{children:[(0,o.jsx)("summary",{children:"Examples (Node.js)"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"// One-to-few\nawait db.collection('posts').insertOne({\n  _id: 1,\n  comments: [{ t: 'ok' }, { t: 'nice' }]\n});\n\n// One-to-many (bucket pattern)\nawait db.collection('events').insertOne({\n  _id: 'user:1:2025-01',\n  events: [] // bounded\n});\n\n// Many-to-many\nawait db.collection('memberships').insertOne({ userId: 1, groupId: 10 });\n"})})]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"schema-evolution",children:"Schema Evolution"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Forward-compatible changes preferred"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Safe changes"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Add fields"}),"\n",(0,o.jsx)(n.li,{children:"Make fields optional"}),"\n",(0,o.jsx)(n.li,{children:"Rename via dual-write"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Dangerous changes"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Type changes"}),"\n",(0,o.jsx)(n.li,{children:"Removing required fields"}),"\n"]}),"\n",(0,o.jsxs)(i,{children:[(0,o.jsx)("summary",{children:"Examples (Node.js)"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"// Backward-compatible add\nawait db.collection('users').updateMany(\n  {},\n  { $set: { status: 'active' } }\n);\n\n// Dual-write rename strategy\nawait db.collection('users').updateOne(\n  { _id: 1 },\n  { $set: { givenName: 'A' } }\n);\n"})})]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"document-growth-and-padding",children:"Document Growth and Padding"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"In-place growth may cause document relocation"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Facts"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"WiredTiger uses document-level allocation"}),"\n",(0,o.jsx)(n.li,{children:"Growing documents can fragment storage"}),"\n",(0,o.jsx)(n.li,{children:"Unbounded arrays are primary risk"}),"\n"]}),"\n",(0,o.jsxs)(i,{children:[(0,o.jsx)("summary",{children:"Examples (Node.js)"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"// Risky unbounded growth\nawait db.collection('logs').updateOne(\n  { _id: 1 },\n  { $push: { entries: { ts: Date.now() } } }\n);\n\n// Safer bucketed pattern\nawait db.collection('logs').insertOne({\n  _id: 'log:1:001',\n  entries: [] // capped at app level\n});\n"})})]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"namespace-management",children:"Namespace Management"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Database + collection naming and limits"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Rules"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Namespace = ",(0,o.jsx)(n.code,{children:"<db>.<collection>"})]}),"\n",(0,o.jsx)(n.li,{children:"Max length: 255 bytes"}),"\n",(0,o.jsx)(n.li,{children:"System collections are reserved"}),"\n"]}),"\n",(0,o.jsxs)(i,{children:[(0,o.jsx)("summary",{children:"Examples (Node.js)"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"// List collections\nawait db.listCollections().toArray();\n\n// Drop collection\nawait db.collection('temp').drop();\n\n// Rename collection\nawait db.admin().command({\n  renameCollection: 'app.old',\n  to: 'app.new',\n  dropTarget: false // boolean\n});\n"})})]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Schema design is ",(0,o.jsx)(n.strong,{children:"query-pattern driven"})]}),"\n",(0,o.jsx)(n.li,{children:"Reads are optimized over writes by default"}),"\n",(0,o.jsx)(n.li,{children:"Most performance issues originate here"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"caveats",children:"Caveats"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Over-embedding causes document bloat"}),"\n",(0,o.jsx)(n.li,{children:"Schema drift breaks assumptions"}),"\n",(0,o.jsx)(n.li,{children:"Poor namespace hygiene complicates ops"}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);