"use strict";(globalThis.webpackChunkbetter_docs=globalThis.webpackChunkbetter_docs||[]).push([[7985],{3944(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>t,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"mongo/mongodb-query-execution-engine","title":"Query Execution Engine","description":"----------------","source":"@site/docs/mongo/Query Execution.md","sourceDirName":"mongo","slug":"/mongo/mongodb-query-execution-engine","permalink":"/better-docs/docs/mongo/mongodb-query-execution-engine","draft":false,"unlisted":false,"editUrl":"https://github.com/chappidirushi/better-docs/tree/main/docs/mongo/Query Execution.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"id":"mongodb-query-execution-engine","title":"Query Execution Engine","sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"CRUD Operations","permalink":"/better-docs/docs/mongo/mongodb-crud"},"next":{"title":"Indexing System","permalink":"/better-docs/docs/mongo/mongodb-indexing-system"}}');var r=s(4848),l=s(8453);const t={id:"mongodb-query-execution-engine",title:"Query Execution Engine",sidebar_position:6},o=void 0,c={},a=[{value:"Query Parsing",id:"query-parsing",level:2},{value:"Query Planner",id:"query-planner",level:2},{value:"Execution Plans",id:"execution-plans",level:2},{value:"Covered Queries",id:"covered-queries",level:2},{value:"Cursor Behavior",id:"cursor-behavior",level:2},{value:"Query Cache",id:"query-cache",level:2},{value:"Explain Plans",id:"explain-plans",level:2},{value:"Notes",id:"notes",level:2},{value:"Caveats",id:"caveats",level:2}];function d(e){const n={blockquote:"blockquote",code:"code",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"query-parsing",children:"Query Parsing"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Converts client queries into an internal canonical representation"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Syntax + semantic validation"}),"\n",(0,r.jsx)(n.li,{children:"Normalizes query shape"}),"\n",(0,r.jsx)(n.li,{children:"Rejects invalid operators early"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Parsed into internal match expression tree\nawait db.collection('users').find({\n  age: { $gte: 18 },\n  status: 'active'\n}).toArray();\n\n// Invalid operator \u2192 parse-time error\nawait db.collection('users').find({ age: { $foo: 10 } }).toArray();\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"query-planner",children:"Query Planner"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Chooses the most efficient execution strategy"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Generates multiple candidate plans"}),"\n",(0,r.jsx)(n.li,{children:"Ranks plans using cost model"}),"\n",(0,r.jsx)(n.li,{children:"Uses available indexes"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Planner evaluates index options\nawait db.collection('users')\n  .find({ email: 'a@x.com', status: 'active' })\n  .explain('queryPlanner');\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"execution-plans",children:"Execution Plans"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Concrete plan tree executed by the engine"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Stage-based execution (IXSCAN, FETCH, SORT)"}),"\n",(0,r.jsx)(n.li,{children:"Blocking vs streaming stages"}),"\n",(0,r.jsx)(n.li,{children:"Short-circuiting on limits"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"await db.collection('users')\n  .find({ age: { $gt: 30 } })\n  .sort({ age: 1 })\n  .limit(10)\n  .explain('executionStats');\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"covered-queries",children:"Covered Queries"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Queries satisfied entirely by an index"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"No document fetch (no FETCH stage)"}),"\n",(0,r.jsx)(n.li,{children:"Requires index covers filter + projection"}),"\n",(0,r.jsx)(n.li,{children:"Fastest possible read path"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Create covering index\nawait db.collection('users').createIndex({ email: 1, status: 1 });\n\n// Covered query\nawait db.collection('users')\n  .find(\n    { email: 'a@x.com' },\n    { projection: { email: 1, status: 1, _id: 0 } }\n  )\n  .explain('executionStats');\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"cursor-behavior",children:"Cursor Behavior"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Server-side cursor streams results in batches"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Default batch size (~101)"}),"\n",(0,r.jsx)(n.li,{children:"Cursor timeout (10 min idle)"}),"\n",(0,r.jsx)(n.li,{children:"Cursor pinned during getMore"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"const cursor = db.collection('users')\n  .find({})\n  .batchSize(50); // number\n\nwhile (await cursor.hasNext()) {\n  await cursor.next();\n}\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"query-cache",children:"Query Cache"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Caches winning plans by query shape"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Keyed by query shape, not values"}),"\n",(0,r.jsx)(n.li,{children:"Re-plans on performance degradation"}),"\n",(0,r.jsx)(n.li,{children:"Invalidated on index changes"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Same shape, different values \u2192 cached plan\nawait db.collection('users').find({ age: { $gt: 20 } }).toArray();\nawait db.collection('users').find({ age: { $gt: 40 } }).toArray();\n\n// Clear plan cache\nawait db.collection('users').getPlanCache().clear();\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"explain-plans",children:"Explain Plans"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Introspection into planner and executor behavior"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"queryPlanner"}),": chosen plan only"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"executionStats"}),": runtime metrics"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"allPlansExecution"}),": compares candidates"]}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"await db.collection('users')\n  .find({ age: { $gte: 18 } })\n  .explain('allPlansExecution');\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Query shape stability improves cache reuse"}),"\n",(0,r.jsx)(n.li,{children:"Index design directly controls planner output"}),"\n",(0,r.jsx)(n.li,{children:"Explain is mandatory for performance debugging"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"caveats",children:"Caveats"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Cached plans can become suboptimal"}),"\n",(0,r.jsx)(n.li,{children:"Blocking stages impact memory"}),"\n",(0,r.jsx)(n.li,{children:"Missing projections break covered queries"}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>t,x:()=>o});var i=s(6540);const r={},l=i.createContext(r);function t(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);