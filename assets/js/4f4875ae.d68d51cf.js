"use strict";(globalThis.webpackChunkbetter_docs=globalThis.webpackChunkbetter_docs||[]).push([[4043],{4821(e,n,s){s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>g,frontMatter:()=>t,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"mongo/mongoose-queries","title":"Mongoose Queries \u2013 Complete Reference","description":"----------------","source":"@site/docs/mongo/Mognooges Queries.md","sourceDirName":"mongo","slug":"/mongo/mongoose-queries","permalink":"/better-docs/docs/mongo/mongoose-queries","draft":false,"unlisted":false,"editUrl":"https://github.com/chappidirushi/better-docs/tree/main/docs/mongo/Mognooges Queries.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"id":"mongoose-queries","title":"Mongoose Queries \u2013 Complete Reference","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Glossary","permalink":"/better-docs/docs/mongo/glossary"},"next":{"title":"Mongoose Schema \u2013 Complete Reference Example","permalink":"/better-docs/docs/mongo/mongoose-schema-complete"}}');var r=s(4848),a=s(8453);const t={id:"mongoose-queries",title:"Mongoose Queries \u2013 Complete Reference",sidebar_position:1},l=void 0,o={},c=[{value:"Model Query Methods",id:"model-query-methods",level:2},{value:"Query Filters (Conditions)",id:"query-filters-conditions",level:2},{value:"Projection (Field Selection)",id:"projection-field-selection",level:2},{value:"Query Modifiers",id:"query-modifiers",level:2},{value:"Lean Queries",id:"lean-queries",level:2},{value:"Populate",id:"populate",level:2},{value:"Query Execution",id:"query-execution",level:2},{value:"Cursors &amp; Streaming",id:"cursors--streaming",level:2},{value:"Pagination Patterns",id:"pagination-patterns",level:2},{value:"Transactions &amp; Sessions",id:"transactions--sessions",level:2},{value:"Explain &amp; Debugging",id:"explain--debugging",level:2},{value:"Error Scenarios",id:"error-scenarios",level:2},{value:"Aggregation Framework",id:"aggregation-framework",level:2},{value:"Aggregation Stages (Complete)",id:"aggregation-stages-complete",level:2},{value:"Expressions &amp; Operators",id:"expressions--operators",level:2},{value:"Aggregation Options &amp; Helpers",id:"aggregation-options--helpers",level:2},{value:"Lookups (Advanced)",id:"lookups-advanced",level:2},{value:"Facets &amp; Analytics Patterns",id:"facets--analytics-patterns",level:2},{value:"Write Aggregations",id:"write-aggregations",level:2},{value:"Aggregation \u2013 Full End\u2011to\u2011End Example (Everything Combined)",id:"aggregation--full-endtoend-example-everything-combined",level:2},{value:"Aggregation Performance Notes",id:"aggregation-performance-notes",level:2},{value:"Distinct &amp; MapReduce (Legacy)",id:"distinct--mapreduce-legacy",level:2},{value:"Query Helpers &amp; Reuse",id:"query-helpers--reuse",level:2},{value:"Notes",id:"notes",level:2},{value:"Caveats",id:"caveats",level:2}];function d(e){const n={code:"code",h2:"h2",hr:"hr",li:"li",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"model-query-methods",children:"Model Query Methods"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"Model.find(filter?, projection?, options?)       // returns Query<Array<Doc>>\nModel.findOne(filter?, projection?, options?)    // returns Query<Doc|null>\nModel.findById(id, projection?, options?)        // id | string | ObjectId\nModel.countDocuments(filter?, options?)          // accurate count\nModel.estimatedDocumentCount(options?)           // fast, approximate\n"})}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"await User.find({ isActive: true });\nawait User.findOne({ email });\nawait User.findById(userId);\nawait User.countDocuments({ role: 'admin' });\nawait User.estimatedDocumentCount();\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"query-filters-conditions",children:"Query Filters (Conditions)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// comparison\n{ age: { $gt: 18, $lte: 60 } }\n\n// logical\n{ $and: [{ a: 1 }, { b: 2 }] }\n{ $or: [{ a: 1 }, { b: 2 }] }\n{ $nor: [{ a: 1 }, { b: 2 }] }\n{ $not: { a: 1 } }\n\n// element\n{ field: { $exists: true, $type: 'string' } }\n\n// array\n{ tags: { $in: ['a', 'b'] } }\n{ tags: { $all: ['a', 'b'] } }\n{ tags: { $size: 3 } }\n\n// regex\n{ name: /john/i }\n"})}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"await User.find({ age: { $gte: 18, $lt: 30 } });\nawait User.find({ $or: [{ role: 'admin' }, { isActive: true }] });\nawait User.find({ tags: { $in: ['node', 'mongo'] } });\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"projection-field-selection",children:"Projection (Field Selection)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// include\n{ name: 1, email: 1 }\n\n// exclude\n{ password: 0 }\n\n// string syntax\n'name email -_id'\n"})}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"await User.find({}, 'name email');\nawait User.find({}, { name: 1, email: 1 });\nawait User.find({}, { password: 0, deletedAt: 0 });\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"query-modifiers",children:"Query Modifiers"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"query.sort(sort)            // object | string\nquery.limit(n)              // number\nquery.skip(n)               // number\nquery.collation(options)    // object\nquery.hint(index)           // object | string\n"})}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"await User.find()\n  .sort({ created_at: -1 })\n  .skip(20)\n  .limit(10)\n  .collation({ locale: 'en', strength: 2 })\n  .hint({ email: 1 });\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"lean-queries",children:"Lean Queries"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"query.lean(options?)        // boolean | object\n"})}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"await User.find().lean();\nawait User.find().lean({ virtuals: false, getters: false });\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"populate",children:"Populate"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"query.populate(path | options)\n"})}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"await User.find()\n  .populate('organizationId');\n\nawait User.find()\n  .populate({\n    path: 'organizationId',\n    select: 'name',\n    match: { isActive: true },\n    options: { lean: true }\n  });\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"query-execution",children:"Query Execution"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"query.exec()                // Promise\nawait query                 // implicit exec\n"})}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"const q = User.find({ isActive: true });\nawait q.exec();\nawait q; // same\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"cursors--streaming",children:"Cursors & Streaming"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"query.cursor(options?)      // QueryCursor\n"})}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"for await (const doc of User.find().cursor()) {\n  console.log(doc._id);\n}\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"pagination-patterns",children:"Pagination Patterns"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// offset-based\nquery.skip(page * limit).limit(limit)\n\n// cursor-based\n{ _id: { $gt: lastId } }\n"})}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// offset\nawait User.find().skip(100).limit(20);\n\n// cursor\nawait User.find({ _id: { $gt: lastId } })\n  .sort({ _id: 1 })\n  .limit(20);\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"transactions--sessions",children:"Transactions & Sessions"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"query.session(session)\n"})}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"const session = await mongoose.startSession();\nawait session.withTransaction(async () => {\n  await User.find({ isActive: true }).session(session);\n});\nsession.endSession();\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"explain--debugging",children:"Explain & Debugging"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"query.explain(verbosity?)   // 'queryPlanner' | 'executionStats' | 'allPlansExecution'\n"})}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"await User.find({ email })\n  .hint({ email: 1 })\n  .explain('executionStats');\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"error-scenarios",children:"Error Scenarios"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"CastError\nValidationError\nMongoServerError\n"})}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"try {\n  await User.findById('invalid');\n} catch (err) {\n  if (err.name === 'CastError') {\n    // handle\n  }\n}\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"aggregation-framework",children:"Aggregation Framework"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"Model.aggregate(pipeline, options?)   // returns Aggregation\n"})}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// basic pipeline\nawait User.aggregate([\n  { $match: { isActive: true } },\n  { $group: { _id: '$role', count: { $sum: 1 } } },\n  { $sort: { count: -1 } }\n]);\n\n// with projection & expressions\nawait User.aggregate([\n  { $match: { age: { $gte: 18 } } },\n  {\n    $project: {\n      name: 1,\n      email: 1,\n      isAdult: { $gte: ['$age', 18] },\n      year: { $year: '$created_at' }\n    }\n  }\n]);\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"aggregation-stages-complete",children:"Aggregation Stages (Complete)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"$match        // filter documents\n$project      // reshape documents\n$addFields    // add computed fields\n$set          // alias of $addFields\n$unset        // remove fields\n$group        // aggregation\n$sort         // ordering\n$limit        // limit docs\n$skip         // skip docs\n$unwind       // deconstruct arrays\n$lookup       // joins\n$facet        // multi pipelines\n$bucket       // grouping ranges\n$bucketAuto   // automatic buckets\n$sample       // random sample\n$count        // count docs\n$replaceRoot  // replace document root\n$replaceWith  // alias\n$sortByCount  // group + sort\n$merge        // write results\n$out          // write results (collection replace)\n"})}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"await User.aggregate([\n  { $unwind: '$roles' },\n  { $sortByCount: '$roles' }\n]);\n\nawait User.aggregate([\n  { $bucket: { groupBy: '$age', boundaries: [18,30,50,100], default: 'other' } }\n]);\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"expressions--operators",children:"Expressions & Operators"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// arithmetic\n$add $subtract $multiply $divide $mod\n\n// comparison\n$eq $ne $gt $gte $lt $lte\n\n// boolean\n$and $or $not\n\n// conditional\n$cond $ifNull $switch\n\n// array\n$map $filter $reduce $size $arrayElemAt\n\n// string\n$concat $substr $toLower $toUpper $trim\n\n// date\n$year $month $dayOfMonth $dateDiff\n"})}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"await User.aggregate([\n  {\n    $project: {\n      emailDomain: { $arrayElemAt: [{ $split: ['$email', '@'] }, 1] },\n      tagsCount: { $size: '$tags' }\n    }\n  }\n]);\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"aggregation-options--helpers",children:"Aggregation Options & Helpers"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"agg.allowDiskUse(true)        // boolean\nagg.collation(options)       // object\nagg.hint(index)               // object | string\nagg.cursor({ batchSize })     // stream\nagg.read(readPref)            // read preference\nagg.explain()                 // execution stats\n"})}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"await User.aggregate([{ $match: { isActive: true } }])\n  .allowDiskUse(true)\n  .hint({ isActive: 1 })\n  .explain('executionStats');\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"lookups-advanced",children:"Lookups (Advanced)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// simple\n$lookup: { from, localField, foreignField, as }\n\n// pipeline\n$lookup: { from, let, pipeline, as }\n"})}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"await User.aggregate([\n  {\n    $lookup: {\n      from: 'organizations',\n      let: { orgId: '$organizationId' },\n      pipeline: [\n        { $match: { $expr: { $eq: ['$_id', '$$orgId'] } } },\n        { $project: { name: 1 } }\n      ],\n      as: 'org'\n    }\n  }\n]);\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"facets--analytics-patterns",children:"Facets & Analytics Patterns"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"$facet\n"})}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"await User.aggregate([\n  { $match: { isActive: true } },\n  {\n    $facet: {\n      data: [{ $sort: { created_at: -1 } }, { $limit: 10 }],\n      total: [{ $count: 'count' }],\n      roles: [{ $sortByCount: '$role' }]\n    }\n  }\n]);\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"write-aggregations",children:"Write Aggregations"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"$out     // replaces collection\n$merge   // merge into collection\n"})}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"await User.aggregate([\n  { $match: { isActive: false } },\n  { $merge: { into: 'inactive_users', whenMatched: 'replace' } }\n]);\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"aggregation--full-endtoend-example-everything-combined",children:"Aggregation \u2013 Full End\u2011to\u2011End Example (Everything Combined)"}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Complete aggregation usage example"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"await User.aggregate([\n  // 1\ufe0f\u20e3 Early filter (uses index if present)\n  {\n    $match: {\n      isActive: true,\n      age: { $gte: 18, $lte: 60 },           // comparison\n      roles: { $in: ['user', 'admin'] }     // array\n    }\n  },\n\n  // 2\ufe0f\u20e3 Join with another collection (pipeline lookup)\n  {\n    $lookup: {\n      from: 'organizations',\n      let: { orgId: '$organizationId' },\n      pipeline: [\n        {\n          $match: {\n            $expr: { $eq: ['$_id', '$$orgId'] } // correlated subquery\n          }\n        },\n        { $project: { name: 1, tier: 1 } }     // projection inside lookup\n      ],\n      as: 'organization'\n    }\n  },\n\n  // 3\ufe0f\u20e3 Normalize joined array\n  { $unwind: '$organization' },\n\n  // 4\ufe0f\u20e3 Compute derived fields\n  {\n    $addFields: {\n      emailDomain: {                        // string + array ops\n        $arrayElemAt: [{ $split: ['$email', '@'] }, 1]\n      },\n      isAdult: { $gte: ['$age', 18] },      // comparison\n      roleCount: { $size: '$roles' }        // array size\n    }\n  },\n\n  // 5\ufe0f\u20e3 Reshape output\n  {\n    $project: {\n      name: 1,\n      email: 1,\n      emailDomain: 1,\n      isAdult: 1,\n      roleCount: 1,\n      'organization.name': 1,\n      'organization.tier': 1,\n      createdYear: { $year: '$created_at' } // date operator\n    }\n  },\n\n  // 6\ufe0f\u20e3 Faceted analytics (data + metadata in one query)\n  {\n    $facet: {\n      data: [\n        { $sort: { createdYear: -1 } },      // sort\n        { $skip: 0 },                        // pagination offset\n        { $limit: 10 }                       // pagination limit\n      ],\n      stats: [\n        { $group: { _id: '$organization.tier', count: { $sum: 1 } } }\n      ]\n    }\n  }\n])\n  // 7\ufe0f\u20e3 Aggregation-level options\n  .allowDiskUse(true)                        // spill to disk\n  .hint({ isActive: 1 })                     // force index\n  .collation({ locale: 'en', strength: 2 })  // case-insensitive\n  .explain('executionStats');                // execution plan\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"aggregation-performance-notes",children:"Aggregation Performance Notes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"$match"})," should be first whenever possible"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"$lookup"})," \u2260 ",(0,r.jsx)(n.code,{children:"populate"})," (no middleware, no schema)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"$facet"})," is CPU heavy but network-efficient"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"$out"})," / ",(0,r.jsx)(n.code,{children:"$merge"})," require exclusive write intent"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"distinct--mapreduce-legacy",children:"Distinct & MapReduce (Legacy)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"Model.distinct(field, filter?)\nModel.mapReduce(options)\n"})}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"await User.distinct('role', { isActive: true });\n\n// mapReduce (legacy, avoid in new systems)\nawait User.mapReduce({\n  map() { emit(this.role, 1); },\n  reduce(key, values) { return Array.sum(values); }\n});\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"query-helpers--reuse",children:"Query Helpers & Reuse"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"schema.query.active = function () {\n  return this.where({ isActive: true });\n};\n"})}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"await User.find().active().limit(10);\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Queries are ",(0,r.jsx)(n.strong,{children:"lazy"})," until executed"]}),"\n",(0,r.jsxs)(n.li,{children:["Order of chaining matters (",(0,r.jsx)(n.code,{children:"sort"})," before ",(0,r.jsx)(n.code,{children:"limit"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Prefer ",(0,r.jsx)(n.strong,{children:"lean + projection"})," for read-heavy paths"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"caveats",children:"Caveats"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Overusing populate causes N+1 queries"}),"\n",(0,r.jsx)(n.li,{children:"Skip-based pagination degrades on large collections"}),"\n",(0,r.jsxs)(n.li,{children:["Always validate indexes with ",(0,r.jsx)(n.code,{children:"explain()"})]}),"\n"]})]})}function g(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>t,x:()=>l});var i=s(6540);const r={},a=i.createContext(r);function t(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);