"use strict";(globalThis.webpackChunkbetter_docs=globalThis.webpackChunkbetter_docs||[]).push([[2146],{8117(e,n,s){s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"Angular/dependency-injection","title":"Dependency Injection","description":"---","source":"@site/docs/Angular/dependency-injection.md","sourceDirName":"Angular","slug":"/Angular/dependency-injection","permalink":"/docs/Angular/dependency-injection","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Angular/dependency-injection.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Content Projection","permalink":"/docs/Angular/content-projection"},"next":{"title":"Angular Directives","permalink":"/docs/Angular/directives"}}');var i=s(4848),o=s(8453);const t={},c="Dependency Injection",l={},d=[{value:"\u2b50 Overview",id:"-overview",level:2},{value:"\ud83e\udde9 Creating &amp; Using Services",id:"-creating--using-services",level:2},{value:"Inject into a component (modern style)",id:"inject-into-a-component-modern-style",level:3},{value:"\ud83c\udfd7 Defining Dependency Providers",id:"-defining-dependency-providers",level:2},{value:"1\ufe0f\u20e3 Class as token (default)",id:"1\ufe0f\u20e3-class-as-token-default",level:3},{value:"2\ufe0f\u20e3 Local providers (override scope)",id:"2\ufe0f\u20e3-local-providers-override-scope",level:3},{value:"3\ufe0f\u20e3 Use <code>useClass</code>, <code>useExisting</code>, <code>useValue</code>, <code>useFactory</code>",id:"3\ufe0f\u20e3-use-useclass-useexisting-usevalue-usefactory",level:3},{value:"4\ufe0f\u20e3 Multi\u2011providers",id:"4\ufe0f\u20e3-multiproviders",level:3},{value:"\ud83c\udf10 Injection Context",id:"-injection-context",level:2},{value:"\ud83c\udf32 Hierarchical Injectors",id:"-hierarchical-injectors",level:2},{value:"Scope a service to a feature/component",id:"scope-a-service-to-a-featurecomponent",level:3},{value:"<code>providers</code> vs <code>viewProviders</code>",id:"providers-vs-viewproviders",level:3},{value:"\ud83e\udde0 Optimizing Injection Tokens",id:"-optimizing-injection-tokens",level:2},{value:"Prefer typed <code>InjectionToken</code>",id:"prefer-typed-injectiontoken",level:3},{value:"Tree\u2011shakable tokens with factory",id:"treeshakable-tokens-with-factory",level:3},{value:"Use multi\u2011tokens for extensibility",id:"use-multitokens-for-extensibility",level:3},{value:"Avoid string tokens",id:"avoid-string-tokens",level:3},{value:"\ud83d\udccc Tips &amp; Best Practices",id:"-tips--best-practices",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"dependency-injection",children:"Dependency Injection"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-overview",children:"\u2b50 Overview"}),"\n",(0,i.jsxs)(n.p,{children:["Angular dependency injection (DI) ",(0,i.jsx)(n.strong,{children:"creates and delivers service instances to classes that need them"}),", using a tree of injectors for scoping and reuse."]}),"\n",(0,i.jsx)(n.p,{children:"Key ideas:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Service"})," = reusable logic class"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Provider"})," = recipe telling Angular how to create a dependency"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Injector"})," = runtime container that resolves dependencies"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Token"})," = lookup key for a dependency (usually the class)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Scope"})," = where an instance lives (root / component / module boundary / custom)"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-creating--using-services",children:"\ud83e\udde9 Creating & Using Services"}),"\n",(0,i.jsxs)(n.p,{children:["A ",(0,i.jsx)(n.strong,{children:"service"})," is a class marked with ",(0,i.jsx)(n.code,{children:"@Injectable()"})," so Angular can inject it."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"import { Injectable } from '@angular/core';\n\n@Injectable({ providedIn: 'root' }) // tree\u2011shakable, app\u2011wide singleton\nexport class UserService {\n  user = { name: 'Alex' };\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"inject-into-a-component-modern-style",children:"Inject into a component (modern style)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"import { Component, inject } from '@angular/core';\nimport { UserService } from './user.service';\n\n@Component({\n  selector: 'app-profile',\n  standalone: true,\n  template: `Hello {{ userService.user.name }}`\n})\nexport class ProfileComponent {\n  userService = inject(UserService); // field\u2011level injection\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You can still inject via constructor, but ",(0,i.jsx)(n.code,{children:"inject()"})," is preferred in standalone apps."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-defining-dependency-providers",children:"\ud83c\udfd7 Defining Dependency Providers"}),"\n",(0,i.jsxs)(n.p,{children:["A ",(0,i.jsx)(n.strong,{children:"provider defines how Angular creates a value for a token"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"1\ufe0f\u20e3-class-as-token-default",children:"1\ufe0f\u20e3 Class as token (default)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"@Injectable({ providedIn: 'root' })\nexport class ApiService {}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2\ufe0f\u20e3-local-providers-override-scope",children:"2\ufe0f\u20e3 Local providers (override scope)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"@Component({\n  selector: 'app-local',\n  standalone: true,\n  providers: [ApiService],\n  template: ''\n})\nexport class LocalComponent {}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This creates ",(0,i.jsx)(n.strong,{children:"a new instance for this component subtree"}),"."]}),"\n",(0,i.jsxs)(n.h3,{id:"3\ufe0f\u20e3-use-useclass-useexisting-usevalue-usefactory",children:["3\ufe0f\u20e3 Use ",(0,i.jsx)(n.code,{children:"useClass"}),", ",(0,i.jsx)(n.code,{children:"useExisting"}),", ",(0,i.jsx)(n.code,{children:"useValue"}),", ",(0,i.jsx)(n.code,{children:"useFactory"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"providers: [\n  { provide: Logger, useClass: ConsoleLogger },           // map class \u2192 impl\n  { provide: BaseLogger, useExisting: Logger },           // alias existing\n  { provide: APP_VERSION, useValue: '1.2.3' },            // constant\n  { provide: Token, useFactory: () => new Thing() }       // factory\n]\n"})}),"\n",(0,i.jsx)(n.h3,{id:"4\ufe0f\u20e3-multiproviders",children:"4\ufe0f\u20e3 Multi\u2011providers"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"{ provide: HOOKS, multi: true, useValue: 'hook-a' }\n{ provide: HOOKS, multi: true, useValue: 'hook-b' }\n// injection returns: ['hook-a','hook-b']\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-injection-context",children:"\ud83c\udf10 Injection Context"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"inject()"})," ",(0,i.jsx)(n.strong,{children:"only works inside an Angular injection context"})," (component creation, provider factories, effects, etc.)."]}),"\n",(0,i.jsxs)(n.p,{children:["When outside, use ",(0,i.jsx)(n.code,{children:"runInInjectionContext()"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"import { inject, runInInjectionContext, EnvironmentInjector } from '@angular/core';\n\nexport function doWork(injector: EnvironmentInjector) {\n  return runInInjectionContext(injector, () => {\n    const api = inject(ApiService);\n    return api;\n  });\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Common places that ",(0,i.jsx)(n.strong,{children:"are already in context"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"constructor(...)"})," injection"]}),"\n",(0,i.jsx)(n.li,{children:"inside component/directive/providers"}),"\n",(0,i.jsx)(n.li,{children:"inside factory providers"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Common places ",(0,i.jsx)(n.strong,{children:"NOT in context"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"plain exported functions"}),"\n",(0,i.jsx)(n.li,{children:"setTimeout / event handlers"}),"\n",(0,i.jsx)(n.li,{children:"external library callbacks"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-hierarchical-injectors",children:"\ud83c\udf32 Hierarchical Injectors"}),"\n",(0,i.jsxs)(n.p,{children:["Angular builds a ",(0,i.jsx)(n.strong,{children:"tree of injectors"})," matching the component tree."]}),"\n",(0,i.jsx)(n.p,{children:"Resolution order:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsxs)(n.strong,{children:["Component ",(0,i.jsx)(n.code,{children:"providers"})," / ",(0,i.jsx)(n.code,{children:"viewProviders"})]})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Parent components up the tree"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Environment (root) injector"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"So you can:"}),"\n",(0,i.jsx)(n.h3,{id:"scope-a-service-to-a-featurecomponent",children:"Scope a service to a feature/component"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"@Component({\n  selector: 'app-scope-demo',\n  standalone: true,\n  providers: [CartService],\n  template: `<child />`\n})\nexport class ScopeDemo {}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Every instance of ",(0,i.jsx)(n.code,{children:"ScopeDemo"})," gets ",(0,i.jsx)(n.strong,{children:"its own CartService"}),"."]}),"\n",(0,i.jsxs)(n.h3,{id:"providers-vs-viewproviders",children:[(0,i.jsx)(n.code,{children:"providers"})," vs ",(0,i.jsx)(n.code,{children:"viewProviders"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"providers"})," \u2192 shared with projected content"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"viewProviders"})," \u2192 visible only inside the component view"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"@Component({\n  viewProviders: [PrivateService]\n})\nexport class SecretComponent {}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-optimizing-injection-tokens",children:"\ud83e\udde0 Optimizing Injection Tokens"}),"\n",(0,i.jsxs)(n.p,{children:["A ",(0,i.jsx)(n.strong,{children:"token"})," is the key used to look up a dependency."]}),"\n",(0,i.jsxs)(n.h3,{id:"prefer-typed-injectiontoken",children:["Prefer typed ",(0,i.jsx)(n.code,{children:"InjectionToken"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"import { InjectionToken } from '@angular/core';\n\nexport const API_URL = new InjectionToken<string>('api-url');\n"})}),"\n",(0,i.jsx)(n.p,{children:"Provide & inject:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"providers: [{ provide: API_URL, useValue: 'https://api.example.com' }];\n\nconst url = inject(API_URL);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"treeshakable-tokens-with-factory",children:"Tree\u2011shakable tokens with factory"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"export const ENV = new InjectionToken('env', {\n  providedIn: 'root',\n  factory: () => ({ prod: true })\n});\n"})}),"\n",(0,i.jsxs)(n.p,{children:["No provider array needed \u2192 ",(0,i.jsx)(n.strong,{children:"smaller bundles"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"use-multitokens-for-extensibility",children:"Use multi\u2011tokens for extensibility"}),"\n",(0,i.jsxs)(n.p,{children:["Good for ",(0,i.jsx)(n.strong,{children:"plugin hooks and interceptors"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"export const HOOKS = new InjectionToken<string[]>('hooks', { multi: true });\n"})}),"\n",(0,i.jsx)(n.h3,{id:"avoid-string-tokens",children:"Avoid string tokens"}),"\n",(0,i.jsx)(n.p,{children:"They are brittle and not type\u2011safe."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-tips--best-practices",children:"\ud83d\udccc Tips & Best Practices"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"providedIn: 'root'"})," for most services (tree\u2011shakable singletons)"]}),"\n",(0,i.jsxs)(n.li,{children:["Use component ",(0,i.jsx)(n.code,{children:"providers"})," for ",(0,i.jsx)(n.strong,{children:"scoped state"})]}),"\n",(0,i.jsxs)(n.li,{children:["Prefer ",(0,i.jsx)(n.code,{children:"inject()"})," in standalone apps"]}),"\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsxs)(n.strong,{children:["typed ",(0,i.jsx)(n.code,{children:"InjectionToken"})]})," for primitives & interfaces"]}),"\n",(0,i.jsxs)(n.li,{children:["Be aware of ",(0,i.jsx)(n.strong,{children:"hierarchical resolution"})," to avoid duplicate instances"]}),"\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.strong,{children:"multi\u2011providers"})," for extensibility"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453(e,n,s){s.d(n,{R:()=>t,x:()=>c});var r=s(6540);const i={},o=r.createContext(i);function t(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);