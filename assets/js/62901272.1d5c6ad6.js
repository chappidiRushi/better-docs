"use strict";(globalThis.webpackChunkbetter_docs=globalThis.webpackChunkbetter_docs||[]).push([[8630],{4940(n,e,s){s.r(e),s.d(e,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>t});const i=JSON.parse('{"id":"mongo/mongodb-sharding","title":"Sharding","description":"-----------------","source":"@site/docs/mongo/Shrading.md","sourceDirName":"mongo","slug":"/mongo/mongodb-sharding","permalink":"/better-docs/docs/mongo/mongodb-sharding","draft":false,"unlisted":false,"editUrl":"https://github.com/chappidirushi/better-docs/tree/main/docs/mongo/Shrading.md","tags":[],"version":"current","sidebarPosition":11,"frontMatter":{"id":"mongodb-sharding","title":"Sharding","sidebar_position":11},"sidebar":"tutorialSidebar","previous":{"title":"Replication","permalink":"/better-docs/docs/mongo/mongodb-replication"},"next":{"title":"Storage Engine (WiredTiger)","permalink":"/better-docs/docs/mongo/mongodb-wiredtiger"}}');var r=s(4848),d=s(8453);const a={id:"mongodb-sharding",title:"Sharding",sidebar_position:11},o=void 0,l={},t=[{value:"Sharding Architecture",id:"sharding-architecture",level:2},{value:"Shard Keys",id:"shard-keys",level:2},{value:"Chunk Management",id:"chunk-management",level:2},{value:"Balancer Internals",id:"balancer-internals",level:2},{value:"Hotspot Avoidance",id:"hotspot-avoidance",level:2},{value:"Resharding",id:"resharding",level:2},{value:"Sharding Limitations",id:"sharding-limitations",level:2},{value:"Notes",id:"notes",level:2},{value:"Caveats",id:"caveats",level:2}];function c(n){const e={blockquote:"blockquote",code:"code",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,d.R)(),...n.components},{Details:s}=e;return s||function(n,e){throw new Error("Expected "+(e?"component":"object")+" `"+n+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.h2,{id:"sharding-architecture",children:"Sharding Architecture"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"Cluster composed of shards, config servers, and mongos routers"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Shards store data (replica sets)"}),"\n",(0,r.jsx)(e.li,{children:"Config servers store metadata"}),"\n",(0,r.jsx)(e.li,{children:"mongos routes queries"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-js",children:"// Connect via mongos\nconst client = new MongoClient('mongodb://mongos1,mongos2');\nawait client.connect();\n"})})]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"shard-keys",children:"Shard Keys"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"Field(s) determining data distribution"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Immutable once chosen"}),"\n",(0,r.jsx)(e.li,{children:"High cardinality preferred"}),"\n",(0,r.jsx)(e.li,{children:"Determines query routing"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-js",children:"// Enable sharding and shard a collection\nawait adminDb.command({ enableSharding: 'shop' });\n\nawait adminDb.command({\n  shardCollection: 'shop.orders',\n  key: { userId: 1 } // ranged | hashed\n});\n"})})]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"chunk-management",children:"Chunk Management"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"Data is partitioned into chunks per shard key range"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Default chunk size ~128MB"}),"\n",(0,r.jsx)(e.li,{children:"Chunks split automatically"}),"\n",(0,r.jsx)(e.li,{children:"Moved between shards"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-js",children:"// View chunk metadata\nawait adminDb.command({ listChunks: 'shop.orders' });\n"})})]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"balancer-internals",children:"Balancer Internals"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"Background process equalizing chunk distribution"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Runs on config servers"}),"\n",(0,r.jsx)(e.li,{children:"Migrates chunks"}),"\n",(0,r.jsx)(e.li,{children:"Can be paused"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-js",children:"// Disable balancer\nawait adminDb.command({ balancerStop: 1 });\n\n// Enable balancer\nawait adminDb.command({ balancerStart: 1 });\n"})})]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"hotspot-avoidance",children:"Hotspot Avoidance"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"Preventing uneven load on specific shards"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Avoid monotonically increasing shard keys"}),"\n",(0,r.jsx)(e.li,{children:"Use hashed keys or compound keys"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-js",children:"// Hashed shard key to avoid hotspots\nawait adminDb.command({\n  shardCollection: 'logs.events',\n  key: { eventId: 'hashed' }\n});\n"})})]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"resharding",children:"Resharding"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"Changing shard key without downtime"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Introduced in MongoDB 5.0+"}),"\n",(0,r.jsx)(e.li,{children:"Online operation"}),"\n",(0,r.jsx)(e.li,{children:"Resource intensive"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-js",children:"await adminDb.command({\n  reshardCollection: 'shop.orders',\n  key: { region: 1, createdAt: 1 }\n});\n"})})]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"sharding-limitations",children:"Sharding Limitations"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"Constraints and tradeoffs in sharded clusters"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Scatter-gather queries are expensive"}),"\n",(0,r.jsx)(e.li,{children:"Unique indexes must include shard key"}),"\n",(0,r.jsx)(e.li,{children:"Transactions cost more"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-js",children:"// Inefficient scatter-gather query\nawait db.collection('orders').find({ status: 'pending' }).toArray();\n"})})]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"notes",children:"Notes"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Proper shard key is critical"}),"\n",(0,r.jsx)(e.li,{children:"Sharding scales writes and storage"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"caveats",children:"Caveats"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Poor shard key causes hotspots"}),"\n",(0,r.jsx)(e.li,{children:"Resharding impacts cluster resources"}),"\n",(0,r.jsx)(e.li,{children:"Operational complexity is high"}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,d.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(c,{...n})}):c(n)}},8453(n,e,s){s.d(e,{R:()=>a,x:()=>o});var i=s(6540);const r={},d=i.createContext(r);function a(n){const e=i.useContext(d);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:a(n.components),i.createElement(d.Provider,{value:e},n.children)}}}]);