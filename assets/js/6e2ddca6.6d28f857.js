"use strict";(globalThis.webpackChunkbetter_docs=globalThis.webpackChunkbetter_docs||[]).push([[448],{8453(e,n,s){s.d(n,{R:()=>d,x:()=>t});var i=s(6540);const l={},r=i.createContext(l);function d(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:d(e.components),i.createElement(r.Provider,{value:n},e.children)}},8704(e,n,s){s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>d,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"mongo/mongodb-bson-storage","title":"BSON, Data Types, and Storage Model","description":"----------------","source":"@site/docs/mongo/Storage Model.md","sourceDirName":"mongo","slug":"/mongo/mongodb-bson-storage","permalink":"/better-docs/docs/mongo/mongodb-bson-storage","draft":false,"unlisted":false,"editUrl":"https://github.com/chappidirushi/better-docs/tree/main/docs/mongo/Storage Model.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"mongodb-bson-storage","title":"BSON, Data Types, and Storage Model","sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"MongoDB as a Database System","permalink":"/better-docs/docs/mongo/mongodb-database-system"},"next":{"title":"Documents, Collections, and Schema Design","permalink":"/better-docs/docs/mongo/mongodb-documents-schema"}}');var l=s(4848),r=s(8453);const d={id:"mongodb-bson-storage",title:"BSON, Data Types, and Storage Model",sidebar_position:3},t=void 0,o={},c=[{value:"BSON Encoding",id:"bson-encoding",level:2},{value:"BSON vs JSON",id:"bson-vs-json",level:2},{value:"Data Types and Comparison Order",id:"data-types-and-comparison-order",level:2},{value:"ObjectId Internals",id:"objectid-internals",level:2},{value:"Null vs Missing Fields",id:"null-vs-missing-fields",level:2},{value:"Document Size Limits",id:"document-size-limits",level:2},{value:"Field Ordering and Semantics",id:"field-ordering-and-semantics",level:2},{value:"Notes",id:"notes",level:2},{value:"Caveats",id:"caveats",level:2}];function a(e){const n={blockquote:"blockquote",code:"code",h2:"h2",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"bson-encoding",children:"BSON Encoding"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"Binary JSON optimized for speed, traversal, and type fidelity"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Characteristics"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Little-endian binary format"}),"\n",(0,l.jsx)(n.li,{children:"Type-prefixed fields"}),"\n",(0,l.jsx)(n.li,{children:"Length-prefixed documents"}),"\n",(0,l.jsx)(n.li,{children:"Efficient in-place traversal"}),"\n"]}),"\n",(0,l.jsxs)(s,{children:[(0,l.jsx)("summary",{children:"Examples"}),(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:"// BSON structure (conceptual)\n{\n  <int32 totalSize>,\n  <byte type>, <cstring key>, <value>,\n  ...,\n  <0x00>\n}\n\n// Observe BSON size impact\nObject.bsonsize({ a: 1, b: 'x', c: [1, 2, 3] }); // returns bytes\n"})})]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"bson-vs-json",children:"BSON vs JSON"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"Typed binary vs text-based, lossy representation"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Differences"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"BSON supports Date, Binary, Int32, Int64"}),"\n",(0,l.jsx)(n.li,{children:"JSON has no native type metadata"}),"\n",(0,l.jsx)(n.li,{children:"BSON preserves field order"}),"\n"]}),"\n",(0,l.jsxs)(s,{children:[(0,l.jsx)("summary",{children:"Examples"}),(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:"// JSON loses type information\nJSON.stringify({ d: new Date() }); // date \u2192 string\n\n// BSON preserves type\ndb.col.insertOne({ d: new Date(), n: NumberLong(10) });\n"})})]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"data-types-and-comparison-order",children:"Data Types and Comparison Order"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"Total ordering defined by BSON type precedence"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Comparison order (high \u2192 low)"})}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"MinKey"}),"\n",(0,l.jsx)(n.li,{children:"Null"}),"\n",(0,l.jsx)(n.li,{children:"Numbers (int32, int64, double, decimal)"}),"\n",(0,l.jsx)(n.li,{children:"Symbol / String"}),"\n",(0,l.jsx)(n.li,{children:"Object"}),"\n",(0,l.jsx)(n.li,{children:"Array"}),"\n",(0,l.jsx)(n.li,{children:"BinData"}),"\n",(0,l.jsx)(n.li,{children:"ObjectId"}),"\n",(0,l.jsx)(n.li,{children:"Boolean"}),"\n",(0,l.jsx)(n.li,{children:"Date"}),"\n",(0,l.jsx)(n.li,{children:"Timestamp"}),"\n",(0,l.jsx)(n.li,{children:"Regex"}),"\n",(0,l.jsx)(n.li,{children:"MaxKey"}),"\n"]}),"\n",(0,l.jsxs)(s,{children:[(0,l.jsx)("summary",{children:"Examples"}),(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:"// Type-based ordering\ndb.t.find().sort({ v: 1 });\n\n// Mixed-type values\n{ v: null }\n{ v: 1 }\n{ v: '1' }\n{ v: ObjectId() }\n"})})]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"objectid-internals",children:"ObjectId Internals"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"12-byte globally unique identifier"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Layout"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"4 bytes: Unix timestamp"}),"\n",(0,l.jsx)(n.li,{children:"5 bytes: random (process + host)"}),"\n",(0,l.jsx)(n.li,{children:"3 bytes: incrementing counter"}),"\n"]}),"\n",(0,l.jsxs)(s,{children:[(0,l.jsx)("summary",{children:"Examples"}),(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:"const id = ObjectId();\n\nid.getTimestamp();        // creation time\nid.toHexString();         // 24-char hex\nObjectId.isValid(id);     // true\n\n// Sort by creation time\ndb.col.find().sort({ _id: 1 });\n"})})]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"null-vs-missing-fields",children:"Null vs Missing Fields"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"Semantically distinct but often conflated"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Behavior"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"{ field: null }"})," matches both null and missing"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"$exists"})," differentiates"]}),"\n"]}),"\n",(0,l.jsxs)(s,{children:[(0,l.jsx)("summary",{children:"Examples"}),(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:"// Matches null + missing\ndb.col.find({ a: null });\n\n// Only missing\ndb.col.find({ a: { $exists: false } });\n\n// Only explicit null\ndb.col.find({ a: null, a: { $exists: true } });\n"})})]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"document-size-limits",children:"Document Size Limits"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"Hard 16MB BSON document limit"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Implications"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Unbounded arrays are dangerous"}),"\n",(0,l.jsx)(n.li,{children:"Large binary data belongs in GridFS"}),"\n"]}),"\n",(0,l.jsxs)(s,{children:[(0,l.jsx)("summary",{children:"Examples"}),(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:"// Check document size\nObject.bsonsize(db.col.findOne());\n\n// GridFS usage (large files)\n// fs.files + fs.chunks collections\n"})})]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"field-ordering-and-semantics",children:"Field Ordering and Semantics"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"Field order is preserved and sometimes significant"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Where order matters"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Index key patterns"}),"\n",(0,l.jsxs)(n.li,{children:["Compound ",(0,l.jsx)(n.code,{children:"_id"})]}),"\n",(0,l.jsx)(n.li,{children:"Query shape caching"}),"\n"]}),"\n",(0,l.jsxs)(s,{children:[(0,l.jsx)("summary",{children:"Examples"}),(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:"// Field order preserved\n{ a: 1, b: 2 } !== { b: 2, a: 1 }\n\n// Index key order\ndb.col.createIndex({ a: 1, b: -1 }); // different from { b, a }\n\n// _id compound ordering\n{ _id: { a: 1, b: 2 } }\n"})})]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["BSON favors ",(0,l.jsx)(n.strong,{children:"runtime efficiency over human readability"})]}),"\n",(0,l.jsx)(n.li,{children:"Type ordering directly affects indexes and sorts"}),"\n",(0,l.jsx)(n.li,{children:"ObjectId enables locality-aware inserts"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"caveats",children:"Caveats"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Silent type coercion causes query mismatches"}),"\n",(0,l.jsx)(n.li,{children:"Null handling is a frequent source of bugs"}),"\n",(0,l.jsx)(n.li,{children:"Document bloat leads to performance cliffs"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}}}]);