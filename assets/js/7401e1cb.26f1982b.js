"use strict";(globalThis.webpackChunkbetter_docs=globalThis.webpackChunkbetter_docs||[]).push([[1158],{909(e,n,s){s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>m,frontMatter:()=>r,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"mongo/mongoose-testing-tooling","title":"Testing and Tooling","description":"-----------------","source":"@site/docs/mongo/Mongoose Testing and Tooling.md","sourceDirName":"mongo","slug":"/mongo/mongoose-testing-tooling","permalink":"/better-docs/docs/mongo/mongoose-testing-tooling","draft":false,"unlisted":false,"editUrl":"https://github.com/chappidirushi/better-docs/tree/main/docs/mongo/Mongoose Testing and Tooling.md","tags":[],"version":"current","sidebarPosition":41,"frontMatter":{"id":"mongoose-testing-tooling","title":"Testing and Tooling","sidebar_position":41},"sidebar":"tutorialSidebar","previous":{"title":"Security Considerations","permalink":"/better-docs/docs/mongo/mongoose-security-considerations"},"next":{"title":"Mongoose Migrations and Schema Evolution","permalink":"/better-docs/docs/mongo/mongoose-migrations-schema-evolution"}}');var i=s(4848),t=s(8453);const r={id:"mongoose-testing-tooling",title:"Testing and Tooling",sidebar_position:41},a=void 0,l={},c=[{value:"1. In-Memory MongoDB",id:"1-in-memory-mongodb",level:2},{value:"2. Mocking Mongoose",id:"2-mocking-mongoose",level:2},{value:"3. Schema Testing",id:"3-schema-testing",level:2},{value:"4. Performance Testing",id:"4-performance-testing",level:2},{value:"Notes",id:"notes",level:2},{value:"Caveats",id:"caveats",level:2}];function d(e){const n={blockquote:"blockquote",code:"code",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"1-in-memory-mongodb",children:"1. In-Memory MongoDB"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Ephemeral MongoDB instances for fast, isolated tests"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"mongodb-memory-server\n"})}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"Examples"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"import { MongoMemoryServer } from 'mongodb-memory-server';\n\nlet mongo;\n\nbeforeAll(async () => {\n  mongo = await MongoMemoryServer.create({\n    binary: { version: '6.0.0' }   // string\n  });\n\n  await mongoose.connect(mongo.getUri(), {\n    dbName: 'test',                // string\n    autoIndex: true                // boolean\n  });\n});\n\nafterAll(async () => {\n  await mongoose.disconnect();\n  await mongo.stop();\n});\n"})})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"2-mocking-mongoose",children:"2. Mocking Mongoose"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Isolate business logic without hitting MongoDB"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"jest.spyOn | sinon.stub\n"})}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"Examples"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"// mock model method\njest.spyOn(User, 'findOne').mockResolvedValue({\n  _id: '1',\n  email: 'a@test.com'\n});\n\n// mock document method\njest.spyOn(User.prototype, 'save').mockResolvedValue();\n\n// restore\njest.restoreAllMocks();\n"})})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"3-schema-testing",children:"3. Schema Testing"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Assert schema constraints and behavior"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"validate | required | indexes | middleware\n"})}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"Examples"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"// validation\nconst user = new User({});\n\nconst err = user.validateSync();\nerr.errors.email;                // required\n\n// index existence\nconst indexes = User.schema.indexes();\nindexes.some(([keys]) => keys.email === 1);\n\n// middleware execution\nconst spy = jest.fn();\nschema.pre('save', spy);\nawait new User({ email: 'a@test.com' }).save();\nexpect(spy).toHaveBeenCalled();\n"})})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"4-performance-testing",children:"4. Performance Testing"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Detect regressions and slow queries"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"benchmark | explain | load tests\n"})}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"Examples"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"// query timing\nconsole.time('query');\nawait User.find({ active: true }).lean();\nconsole.timeEnd('query');\n\n// explain plan\nawait User.find({ email })\n  .explain('executionStats');\n\n// basic load loop\nfor (let i = 0; i < 1e4; i++) {\n  await User.findOne({ email }).lean();\n}\n"})})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"In-memory MongoDB is for tests only"}),"\n",(0,i.jsx)(n.li,{children:"Mocking trades realism for speed"}),"\n",(0,i.jsx)(n.li,{children:"Schema tests catch regressions early"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"caveats",children:"Caveats"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"In-memory server behavior can differ from prod"}),"\n",(0,i.jsx)(n.li,{children:"Excessive mocking hides integration issues"}),"\n",(0,i.jsx)(n.li,{children:"Performance tests must reflect real indexes"}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>r,x:()=>a});var o=s(6540);const i={},t=o.createContext(i);function r(e){const n=o.useContext(t);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),o.createElement(t.Provider,{value:n},e.children)}}}]);