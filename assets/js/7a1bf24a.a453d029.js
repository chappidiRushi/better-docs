"use strict";(globalThis.webpackChunkbetter_docs=globalThis.webpackChunkbetter_docs||[]).push([[3019],{1190(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>a,frontMatter:()=>l,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"React/under-the-hood","title":"Under the Hood","description":"----------------","source":"@site/docs/React/Under The Hood.md","sourceDirName":"React","slug":"/React/under-the-hood","permalink":"/better-docs/docs/React/under-the-hood","draft":false,"unlisted":false,"editUrl":"https://github.com/chappidirushi/better-docs/tree/main/docs/React/Under The Hood.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"under-the-hood","title":"Under the Hood","sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Introduction","permalink":"/better-docs/docs/React/introductions"},"next":{"title":"Component","permalink":"/better-docs/docs/React/component"}}');var r=i(4848),t=i(8453);const l={id:"under-the-hood",title:"Under the Hood",sidebar_position:3},d=void 0,c={},h=[{value:"First: A Critical Clarification (Reconciliation vs Fiber)",id:"first-a-critical-clarification-reconciliation-vs-fiber",level:2},{value:"The Big Picture (Keep This Mental Model)",id:"the-big-picture-keep-this-mental-model",level:2},{value:"1. Authoring Phase: Writing JSX",id:"1-authoring-phase-writing-jsx",level:2},{value:"2. Build Time: JSX Compilation",id:"2-build-time-jsx-compilation",level:2},{value:"3. Runtime: React Elements (UI Descriptions)",id:"3-runtime-react-elements-ui-descriptions",level:2},{value:"4. Starting the Render: Root Creation",id:"4-starting-the-render-root-creation",level:2},{value:"5. Fiber: The Internal Representation",id:"5-fiber-the-internal-representation",level:2},{value:"6. Render Phase: Reconciliation (Finding Changes)",id:"6-render-phase-reconciliation-finding-changes",level:2},{value:"What Reconciliation Is",id:"what-reconciliation-is",level:3},{value:"What Happens During Reconciliation",id:"what-happens-during-reconciliation",level:3},{value:"Characteristics of the Render Phase",id:"characteristics-of-the-render-phase",level:3},{value:"7. Scheduling, Priorities, and Concurrency (Fiber\u2019s Job)",id:"7-scheduling-priorities-and-concurrency-fibers-job",level:2},{value:"8. Commit Phase: Applying Changes",id:"8-commit-phase-applying-changes",level:2},{value:"9. Effects and Browser Paint",id:"9-effects-and-browser-paint",level:2},{value:"10. Updates: State, Props, and Re-renders",id:"10-updates-state-props-and-re-renders",level:2},{value:"11. Event System (Synthetic Events)",id:"11-event-system-synthetic-events",level:2},{value:"Stack Reconciler vs Fiber (Why This Matters)",id:"stack-reconciler-vs-fiber-why-this-matters",level:2},{value:"Key Takeaways",id:"key-takeaways",level:2},{value:"Visual Diagram: Current Tree vs Work-In-Progress Tree",id:"visual-diagram-current-tree-vs-work-in-progress-tree",level:2},{value:"Key Idea",id:"key-idea",level:3},{value:"Before an Update (Only Current Tree Exists)",id:"before-an-update-only-current-tree-exists",level:3},{value:"During an Update (Render Phase)",id:"during-an-update-render-phase",level:3},{value:"After Commit (Tree Swap)",id:"after-commit-tree-swap",level:3},{value:"Why This Matters",id:"why-this-matters",level:3},{value:"Hook-by-Hook Timing Table",id:"hook-by-hook-timing-table",level:2},{value:"Hook Execution Timeline",id:"hook-execution-timeline",level:3},{value:"Simplified Timeline View",id:"simplified-timeline-view",level:3},{value:"Practical Rules of Thumb",id:"practical-rules-of-thumb",level:3},{value:"Common Mistake (Worth Calling Out)",id:"common-mistake-worth-calling-out",level:3}];function o(e){const n={blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"first-a-critical-clarification-reconciliation-vs-fiber",children:"First: A Critical Clarification (Reconciliation vs Fiber)"}),"\n",(0,r.jsx)(n.p,{children:"Before the pipeline, let\u2019s fix a common misconception:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Reconciliation"})," is the ",(0,r.jsx)(n.em,{children:"process"})," of figuring out ",(0,r.jsx)(n.strong,{children:"what changed"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Fiber"})," is the ",(0,r.jsx)(n.em,{children:"engine"})," that ",(0,r.jsx)(n.strong,{children:"runs reconciliation and schedules work"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"In short:"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsxs)(n.strong,{children:["Reconciliation decides ",(0,r.jsx)(n.em,{children:"what"})," should change"]}),"\n",(0,r.jsxs)(n.strong,{children:["Fiber decides ",(0,r.jsx)(n.em,{children:"when"})," and ",(0,r.jsx)(n.em,{children:"how"})," that work runs"]})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Fiber does ",(0,r.jsx)(n.strong,{children:"not replace"})," reconciliation \u2014 it ",(0,r.jsx)(n.strong,{children:"implements and powers it"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Keep this distinction in mind as we walk through the pipeline."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"the-big-picture-keep-this-mental-model",children:"The Big Picture (Keep This Mental Model)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-txt",children:"JSX\n \u2192 React Elements (UI description)\n \u2192 Fiber Trees (current & work-in-progress)\n \u2192 Render Phase (reconciliation: find changes)\n \u2192 Commit Phase (apply changes)\n \u2192 Effects\n"})}),"\n",(0,r.jsx)(n.p,{children:"Everything below fits into this flow."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"1-authoring-phase-writing-jsx",children:"1. Authoring Phase: Writing JSX"}),"\n",(0,r.jsxs)(n.p,{children:["Developers write ",(0,r.jsx)(n.strong,{children:"JSX"})," to describe what the UI should look like for a given state."]}),"\n",(0,r.jsx)(n.p,{children:"Key ideas:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["JSX is ",(0,r.jsx)(n.strong,{children:"JavaScript"}),", not HTML"]}),"\n",(0,r.jsxs)(n.li,{children:["Components describe ",(0,r.jsx)(n.strong,{children:"UI intent"}),", not DOM steps"]}),"\n",(0,r.jsx)(n.li,{children:"Function components are just functions that return UI descriptions"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"function App({ name }) {\n  return <h1>Hello {name}</h1>;\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"At this stage:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u274c No rendering"}),"\n",(0,r.jsx)(n.li,{children:"\u274c No DOM"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Just declarative UI intent"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"2-build-time-jsx-compilation",children:"2. Build Time: JSX Compilation"}),"\n",(0,r.jsxs)(n.p,{children:["Before your app ever runs, JSX is compiled by tools like ",(0,r.jsx)(n.strong,{children:"Babel"})," or ",(0,r.jsx)(n.strong,{children:"SWC"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"What happens:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"JSX is transformed into function calls"}),"\n",(0,r.jsxs)(n.li,{children:["This happens at ",(0,r.jsx)(n.strong,{children:"build time"}),", not runtime"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// JSX\n<h1 className=\"title\">Hello</h1>;\n\n// Compiled output (conceptual)\nReact.createElement(\n  'h1',\n  { className: 'title' },\n  'Hello'\n);\n"})}),"\n",(0,r.jsx)(n.p,{children:"Important:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"JSX itself never reaches the browser"}),"\n",(0,r.jsx)(n.li,{children:"The browser only sees plain JavaScript"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"3-runtime-react-elements-ui-descriptions",children:"3. Runtime: React Elements (UI Descriptions)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"React.createElement"})," produces ",(0,r.jsx)(n.strong,{children:"React elements"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"React elements are:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Plain JavaScript objects"}),"\n",(0,r.jsx)(n.li,{children:"Immutable"}),"\n",(0,r.jsxs)(n.li,{children:["Descriptions of ",(0,r.jsx)(n.em,{children:"what the UI should look like"})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["They are often informally called the ",(0,r.jsx)(n.strong,{children:"Virtual DOM"}),", but they are ",(0,r.jsx)(n.strong,{children:"not"})," the real DOM and do nothing by themselves."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"{\n  $$typeof: Symbol(react.element),\n  type: 'h1',\n  key: null,\n  props: {\n    children: 'Hello'\n  }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"At this stage:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u274c No DOM updates"}),"\n",(0,r.jsx)(n.li,{children:"\u274c No effects"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Just a tree of UI descriptions"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"4-starting-the-render-root-creation",children:"4. Starting the Render: Root Creation"}),"\n",(0,r.jsxs)(n.p,{children:["Rendering begins when you create a ",(0,r.jsx)(n.strong,{children:"root"})," and call ",(0,r.jsx)(n.code,{children:"render"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"import { createRoot } from 'react-dom/client';\n\nconst root = createRoot(document.getElementById('root'));\nroot.render(<App name=\"React\" />);\n"})}),"\n",(0,r.jsx)(n.p,{children:"What React does here:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Creates the ",(0,r.jsx)(n.strong,{children:"root Fiber"})]}),"\n",(0,r.jsx)(n.li,{children:"Connects React to the host environment (DOM)"}),"\n",(0,r.jsxs)(n.li,{children:["Schedules the ",(0,r.jsx)(n.strong,{children:"initial render"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This is the entry point into the Fiber system."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"5-fiber-the-internal-representation",children:"5. Fiber: The Internal Representation"}),"\n",(0,r.jsx)(n.p,{children:"React does not work directly with React elements."}),"\n",(0,r.jsxs)(n.p,{children:["Instead, it builds and maintains ",(0,r.jsx)(n.strong,{children:"Fiber trees"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Each Fiber node represents:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A component instance"}),"\n",(0,r.jsx)(n.li,{children:"A DOM node"}),"\n",(0,r.jsx)(n.li,{children:"Or an internal wrapper (like fragments)"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["React maintains ",(0,r.jsx)(n.strong,{children:"two trees"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Current tree"})," \u2192 what\u2019s on the screen now"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Work-in-progress tree"})," \u2192 what React is building next"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"These trees are the foundation for reconciliation."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"6-render-phase-reconciliation-finding-changes",children:"6. Render Phase: Reconciliation (Finding Changes)"}),"\n",(0,r.jsx)(n.h3,{id:"what-reconciliation-is",children:"What Reconciliation Is"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Reconciliation"})," is the process of comparing:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.strong,{children:"current Fiber tree"})]}),"\n",(0,r.jsxs)(n.li,{children:["With a ",(0,r.jsx)(n.strong,{children:"new work-in-progress tree"})," built from React elements"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Its job is to determine:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"What can be reused"}),"\n",(0,r.jsx)(n.li,{children:"What needs to change"}),"\n",(0,r.jsx)(n.li,{children:"What needs to be created or removed"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"what-happens-during-reconciliation",children:"What Happens During Reconciliation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Function components are re-executed"}),"\n",(0,r.jsxs)(n.li,{children:["Child elements are compared by ",(0,r.jsx)(n.strong,{children:"type and key"})]}),"\n",(0,r.jsxs)(n.li,{children:["Fibers are marked with ",(0,r.jsx)(n.strong,{children:"flags"})," describing required changes"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["What reconciliation ",(0,r.jsx)(n.strong,{children:"does not do"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u274c Mutate the DOM"}),"\n",(0,r.jsx)(n.li,{children:"\u274c Run effects"}),"\n",(0,r.jsx)(n.li,{children:"\u274c Guarantee a perfect minimal diff (it\u2019s heuristic-based)"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"characteristics-of-the-render-phase",children:"Characteristics of the Render Phase"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Must be ",(0,r.jsx)(n.strong,{children:"pure"})," (no side effects)"]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Interruptible and restartable"})}),"\n",(0,r.jsx)(n.li,{children:"Can be paused, resumed, or abandoned"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-txt",children:"- Components execute top to bottom\n- Hooks must be called in the same order\n- No DOM mutations occur here\n"})}),"\n",(0,r.jsxs)(n.p,{children:["This is where ",(0,r.jsx)(n.strong,{children:"Fiber\u2019s scheduling power matters"}),"."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"7-scheduling-priorities-and-concurrency-fibers-job",children:"7. Scheduling, Priorities, and Concurrency (Fiber\u2019s Job)"}),"\n",(0,r.jsxs)(n.p,{children:["Fiber allows React to control ",(0,r.jsx)(n.em,{children:"when"})," work happens."]}),"\n",(0,r.jsxs)(n.p,{children:["Each update is assigned a ",(0,r.jsx)(n.strong,{children:"priority"})," (internally via lanes):"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Urgent"})," \u2014 user input (typing, clicks)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Transition"})," \u2014 non-blocking updates (",(0,r.jsx)(n.code,{children:"startTransition"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Default"})," \u2014 normal updates"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Idle"})," \u2014 background work"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Higher-priority work can:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Interrupt lower-priority renders"}),"\n",(0,r.jsx)(n.li,{children:"Cause React to restart reconciliation"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This enables:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Time slicing"}),"\n",(0,r.jsx)(n.li,{children:"Concurrent rendering"}),"\n",(0,r.jsx)(n.li,{children:"Smooth user interactions"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"8-commit-phase-applying-changes",children:"8. Commit Phase: Applying Changes"}),"\n",(0,r.jsxs)(n.p,{children:["Once React finishes reconciliation, it enters the ",(0,r.jsx)(n.strong,{children:"commit phase"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"This phase:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Applies DOM mutations"}),"\n",(0,r.jsx)(n.li,{children:"Updates refs"}),"\n",(0,r.jsxs)(n.li,{children:["Runs ",(0,r.jsx)(n.code,{children:"useLayoutEffect"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Key properties:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Synchronous"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Non-interruptible"})}),"\n",(0,r.jsx)(n.li,{children:"Always reflects the latest completed render"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["This is the ",(0,r.jsx)(n.strong,{children:"only phase"})," where the DOM is touched."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"9-effects-and-browser-paint",children:"9. Effects and Browser Paint"}),"\n",(0,r.jsx)(n.p,{children:"After the commit phase:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"useLayoutEffect"})," runs (before paint)"]}),"\n",(0,r.jsx)(n.li,{children:"Browser paints the screen"}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"useEffect"})," runs (after paint)"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"useEffect(() => {\n  console.log('DOM committed');\n  return () => console.log('cleanup');\n}, []);\n"})}),"\n",(0,r.jsx)(n.p,{children:"This separation prevents layout thrashing and visual tearing."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"10-updates-state-props-and-re-renders",children:"10. Updates: State, Props, and Re-renders"}),"\n",(0,r.jsx)(n.p,{children:"When state or props change:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"setCount(c => c + 1);\n"})}),"\n",(0,r.jsx)(n.p,{children:"What actually happens:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["An update is ",(0,r.jsx)(n.strong,{children:"scheduled"})]}),"\n",(0,r.jsx)(n.li,{children:"A priority is assigned"}),"\n",(0,r.jsx)(n.li,{children:"Reconciliation may restart"}),"\n",(0,r.jsx)(n.li,{children:"DOM updates happen later during commit"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["State updates ",(0,r.jsx)(n.strong,{children:"schedule work"})," \u2014 they do not directly mutate the DOM."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"11-event-system-synthetic-events",children:"11. Event System (Synthetic Events)"}),"\n",(0,r.jsxs)(n.p,{children:["React uses a delegated ",(0,r.jsx)(n.strong,{children:"synthetic event system"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Key points:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"One listener per event type per root"}),"\n",(0,r.jsx)(n.li,{children:"Cross-browser normalization"}),"\n",(0,r.jsx)(n.li,{children:"Event-triggered updates are automatically batched"}),"\n",(0,r.jsx)(n.li,{children:"Updates flow through Fiber like any other update"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Events don\u2019t bypass the rendering pipeline \u2014 they feed into it."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"stack-reconciler-vs-fiber-why-this-matters",children:"Stack Reconciler vs Fiber (Why This Matters)"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Feature"}),(0,r.jsx)(n.th,{children:"Stack (\u226415)"}),(0,r.jsx)(n.th,{children:"Fiber (16+)"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Execution"}),(0,r.jsx)(n.td,{children:"Synchronous"}),(0,r.jsx)(n.td,{children:"Interruptible"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Scheduling"}),(0,r.jsx)(n.td,{children:"\u274c None"}),(0,r.jsx)(n.td,{children:"\u2705 Priority-based"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Time slicing"}),(0,r.jsx)(n.td,{children:"\u274c"}),(0,r.jsx)(n.td,{children:"\u2705"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Suspense"}),(0,r.jsx)(n.td,{children:"\u274c"}),(0,r.jsx)(n.td,{children:"\u2705"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Concurrent UI"}),(0,r.jsx)(n.td,{children:"\u274c"}),(0,r.jsx)(n.td,{children:"\u2705"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Architecture"}),(0,r.jsx)(n.td,{children:"Call stack"}),(0,r.jsx)(n.td,{children:"Fiber tree"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:"Fiber is what makes modern React possible."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"key-takeaways",children:"Key Takeaways"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["JSX describes ",(0,r.jsx)(n.strong,{children:"intent"}),", not instructions"]}),"\n",(0,r.jsxs)(n.li,{children:["React elements are ",(0,r.jsx)(n.strong,{children:"immutable UI descriptions"})]}),"\n",(0,r.jsx)(n.li,{children:"Fiber is React\u2019s internal execution engine"}),"\n",(0,r.jsxs)(n.li,{children:["Reconciliation finds ",(0,r.jsx)(n.strong,{children:"what changed"})]}),"\n",(0,r.jsxs)(n.li,{children:["Commit phase applies ",(0,r.jsx)(n.strong,{children:"actual DOM updates"})]}),"\n",(0,r.jsxs)(n.li,{children:["Effects always run ",(0,r.jsx)(n.strong,{children:"after commit"})]}),"\n",(0,r.jsx)(n.li,{children:"Scheduling and priorities enable smooth, concurrent UIs"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"visual-diagram-current-tree-vs-work-in-progress-tree",children:"Visual Diagram: Current Tree vs Work-In-Progress Tree"}),"\n",(0,r.jsxs)(n.p,{children:["This diagram shows ",(0,r.jsx)(n.strong,{children:"what React is actually doing internally during rendering"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"key-idea",children:"Key Idea"}),"\n",(0,r.jsxs)(n.p,{children:["React ",(0,r.jsx)(n.strong,{children:"never mutates the current UI directly"}),".\nInstead, it builds a ",(0,r.jsx)(n.strong,{children:"new tree in memory"}),", then swaps it in during commit."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"before-an-update-only-current-tree-exists",children:"Before an Update (Only Current Tree Exists)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-txt",children:"Current Fiber Tree (on screen)\n--------------------------------\n<App>\n \u251c\u2500 <Header>\n \u251c\u2500 <Main>\n \u2502   \u251c\u2500 <Post />\n \u2502   \u2514\u2500 <Sidebar />\n \u2514\u2500 <Footer>\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["This tree ",(0,r.jsx)(n.strong,{children:"matches the DOM"})]}),"\n",(0,r.jsx)(n.li,{children:"User is seeing this UI"}),"\n",(0,r.jsx)(n.li,{children:"No work is in progress"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"during-an-update-render-phase",children:"During an Update (Render Phase)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-txt",children:"Current Tree (read-only)        Work-In-Progress Tree (being built)\n-------------------------       -----------------------------------\n<App>                            <App>\n \u251c\u2500 <Header>        \u2500\u2500\u2500\u2500\u2500\u25b6        \u251c\u2500 <Header>        (reused)\n \u251c\u2500 <Main>          \u2500\u2500\u2500\u2500\u2500\u25b6        \u251c\u2500 <Main>\n \u2502   \u251c\u2500 <Post />    \u2500\u2500\u2500\u2500\u2500\u25b6        \u2502   \u251c\u2500 <Post />    (updated)\n \u2502   \u2514\u2500 <Sidebar /> \u2500\u2500\u2500\u2500\u2500\u25b6        \u2502   \u2514\u2500 <Sidebar /> (unchanged)\n \u2514\u2500 <Footer>        \u2500\u2500\u2500\u2500\u2500\u25b6        \u2514\u2500 <Footer>\n"})}),"\n",(0,r.jsx)(n.p,{children:"What\u2019s happening:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["React ",(0,r.jsx)(n.strong,{children:"re-runs components"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Fibers are:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"reused"}),"\n",(0,r.jsx)(n.li,{children:"cloned"}),"\n",(0,r.jsx)(n.li,{children:"or newly created"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Changes are recorded as ",(0,r.jsx)(n.strong,{children:"flags"}),", not DOM mutations"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u26a0\ufe0f The DOM is ",(0,r.jsx)(n.strong,{children:"untouched"})," during this phase."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"after-commit-tree-swap",children:"After Commit (Tree Swap)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-txt",children:"Old Current Tree \u274c (discarded)\n\nNew Current Fiber Tree \u2705 (now on screen)\n----------------------------------------\n<App>\n \u251c\u2500 <Header>\n \u251c\u2500 <Main>\n \u2502   \u251c\u2500 <Post />   \u2190 updated DOM node\n \u2502   \u2514\u2500 <Sidebar />\n \u2514\u2500 <Footer>\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Work-in-progress becomes the ",(0,r.jsx)(n.strong,{children:"new current tree"})]}),"\n",(0,r.jsx)(n.li,{children:"DOM mutations already applied"}),"\n",(0,r.jsx)(n.li,{children:"React is ready for the next update"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"why-this-matters",children:"Why This Matters"}),"\n",(0,r.jsx)(n.p,{children:"This dual-tree model enables:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Interruptible rendering"}),"\n",(0,r.jsx)(n.li,{children:"Safe concurrency"}),"\n",(0,r.jsx)(n.li,{children:"Restartable renders"}),"\n",(0,r.jsx)(n.li,{children:"Predictable commits"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Without it, React would be forced to mutate the DOM mid-render."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"hook-by-hook-timing-table",children:"Hook-by-Hook Timing Table"}),"\n",(0,r.jsxs)(n.p,{children:["This table answers one of the ",(0,r.jsx)(n.strong,{children:"most common sources of confusion"}),":"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"\u201cWhen exactly does each hook run?\u201d"})}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"hook-execution-timeline",children:"Hook Execution Timeline"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Hook"}),(0,r.jsx)(n.th,{children:"Phase"}),(0,r.jsx)(n.th,{children:"Runs When"}),(0,r.jsx)(n.th,{children:"Can Read DOM?"}),(0,r.jsx)(n.th,{children:"Can Mutate DOM?"}),(0,r.jsx)(n.th,{children:"Blocks Paint?"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"useState"})}),(0,r.jsx)(n.td,{children:"Render"}),(0,r.jsx)(n.td,{children:"During render"}),(0,r.jsx)(n.td,{children:"\u274c"}),(0,r.jsx)(n.td,{children:"\u274c"}),(0,r.jsx)(n.td,{children:"\u274c"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"useReducer"})}),(0,r.jsx)(n.td,{children:"Render"}),(0,r.jsx)(n.td,{children:"During render"}),(0,r.jsx)(n.td,{children:"\u274c"}),(0,r.jsx)(n.td,{children:"\u274c"}),(0,r.jsx)(n.td,{children:"\u274c"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"useMemo"})}),(0,r.jsx)(n.td,{children:"Render"}),(0,r.jsx)(n.td,{children:"During render"}),(0,r.jsx)(n.td,{children:"\u274c"}),(0,r.jsx)(n.td,{children:"\u274c"}),(0,r.jsx)(n.td,{children:"\u274c"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"useCallback"})}),(0,r.jsx)(n.td,{children:"Render"}),(0,r.jsx)(n.td,{children:"During render"}),(0,r.jsx)(n.td,{children:"\u274c"}),(0,r.jsx)(n.td,{children:"\u274c"}),(0,r.jsx)(n.td,{children:"\u274c"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"useContext"})}),(0,r.jsx)(n.td,{children:"Render"}),(0,r.jsx)(n.td,{children:"During render"}),(0,r.jsx)(n.td,{children:"\u274c"}),(0,r.jsx)(n.td,{children:"\u274c"}),(0,r.jsx)(n.td,{children:"\u274c"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"useRef"})," (read/write ",(0,r.jsx)(n.code,{children:".current"}),")"]}),(0,r.jsx)(n.td,{children:"Render"}),(0,r.jsx)(n.td,{children:"During render"}),(0,r.jsx)(n.td,{children:"\u274c"}),(0,r.jsx)(n.td,{children:"\u274c"}),(0,r.jsx)(n.td,{children:"\u274c"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"useLayoutEffect"})}),(0,r.jsx)(n.td,{children:"Commit"}),(0,r.jsx)(n.td,{children:"After DOM mutation, before paint"}),(0,r.jsx)(n.td,{children:"\u2705"}),(0,r.jsx)(n.td,{children:"\u2705"}),(0,r.jsx)(n.td,{children:"\u2705"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"useEffect"})}),(0,r.jsx)(n.td,{children:"Post-Commit"}),(0,r.jsx)(n.td,{children:"After paint"}),(0,r.jsx)(n.td,{children:"\u2705"}),(0,r.jsx)(n.td,{children:"\u274c"}),(0,r.jsx)(n.td,{children:"\u274c"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"useInsertionEffect"})}),(0,r.jsx)(n.td,{children:"Commit (early)"}),(0,r.jsx)(n.td,{children:"Before layout effects"}),(0,r.jsx)(n.td,{children:"\u274c"}),(0,r.jsx)(n.td,{children:"\u2705 (styles only)"}),(0,r.jsx)(n.td,{children:"\u2705"})]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"simplified-timeline-view",children:"Simplified Timeline View"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-txt",children:"Render Phase\n------------\nuseState\nuseReducer\nuseMemo\nuseCallback\nuseContext\nuseRef\n\nCommit Phase\n------------\nDOM mutations\nuseInsertionEffect\nuseLayoutEffect\n\nBrowser Paint\n-------------\n(pixels update)\n\nPost-Commit\n-----------\nuseEffect\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"practical-rules-of-thumb",children:"Practical Rules of Thumb"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Never cause side effects in render"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsxs)(n.strong,{children:["DOM reads/writes that must be synchronous \u2192 ",(0,r.jsx)(n.code,{children:"useLayoutEffect"})]})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsxs)(n.strong,{children:["Most side effects \u2192 ",(0,r.jsx)(n.code,{children:"useEffect"})]})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsxs)(n.strong,{children:["CSS-in-JS libraries \u2192 ",(0,r.jsx)(n.code,{children:"useInsertionEffect"})]})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsxs)(n.strong,{children:["Performance optimization only \u2192 ",(0,r.jsx)(n.code,{children:"useMemo"})," / ",(0,r.jsx)(n.code,{children:"useCallback"})]})}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"common-mistake-worth-calling-out",children:"Common Mistake (Worth Calling Out)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"useLayoutEffect(() => {\n  setState(...) // \u26a0\ufe0f can cause layout thrashing\n});\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Blocks paint"}),"\n",(0,r.jsx)(n.li,{children:"Can cause visible jank"}),"\n",(0,r.jsx)(n.li,{children:"Should be rare and intentional"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{})]})}function a(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},8453(e,n,i){i.d(n,{R:()=>l,x:()=>d});var s=i(6540);const r={},t=s.createContext(r);function l(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);