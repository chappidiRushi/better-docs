"use strict";(globalThis.webpackChunkbetter_docs=globalThis.webpackChunkbetter_docs||[]).push([[5080],{5773(e,n,s){s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>x,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"mongo/mongodb-limits-edge-cases","title":"MongoDB Limits, Edge Cases, and Anti-Patterns","description":"-----------------","source":"@site/docs/mongo/Limitiations.md","sourceDirName":"mongo","slug":"/mongo/mongodb-limits-edge-cases","permalink":"/better-docs/docs/mongo/mongodb-limits-edge-cases","draft":false,"unlisted":false,"editUrl":"https://github.com/chappidirushi/better-docs/tree/main/docs/mongo/Limitiations.md","tags":[],"version":"current","sidebarPosition":21,"frontMatter":{"id":"mongodb-limits-edge-cases","title":"MongoDB Limits, Edge Cases, and Anti-Patterns","sidebar_position":21},"sidebar":"tutorialSidebar","previous":{"title":"Drivers and Ecosystem","permalink":"/better-docs/docs/mongo/mongodb-drivers-ecosystem"},"next":{"title":"Mongoose as an Abstraction Layer","permalink":"/better-docs/docs/mongo/mongoose-abstraction-layer"}}');var t=s(4848),r=s(8453);const o={id:"mongodb-limits-edge-cases",title:"MongoDB Limits, Edge Cases, and Anti-Patterns",sidebar_position:21},l=void 0,a={},c=[{value:"Document and Index Limits",id:"document-and-index-limits",level:2},{value:"Transaction Limits",id:"transaction-limits",level:2},{value:"Aggregation Limits",id:"aggregation-limits",level:2},{value:"Hot Documents",id:"hot-documents",level:2},{value:"Massive Arrays",id:"massive-arrays",level:2},{value:"Unindexed Queries",id:"unindexed-queries",level:2},{value:"Notes",id:"notes",level:2},{value:"Caveats",id:"caveats",level:2}];function d(e){const n={blockquote:"blockquote",code:"code",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"document-and-index-limits",children:"Document and Index Limits"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Maximum sizes and structural constraints enforced by the server"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Max document size: ",(0,t.jsx)(n.strong,{children:"16MB"})]}),"\n",(0,t.jsxs)(n.li,{children:["Index key limit: ",(0,t.jsx)(n.strong,{children:"1024 bytes per field"})]}),"\n",(0,t.jsx)(n.li,{children:"Compound index key count limit"}),"\n"]}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Examples (Node.js)"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// Oversized document example\nconst bigDoc = { data: 'x'.repeat(17 * 1024 * 1024) }; // >16MB\nawait db.collection('test').insertOne(bigDoc); // fails\n"})})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"transaction-limits",children:"Transaction Limits"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Constraints on multi-document transactions"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Max transaction size: 16MB oplog entry"}),"\n",(0,t.jsx)(n.li,{children:"Max lifetime: 60 seconds (default)"}),"\n",(0,t.jsx)(n.li,{children:"No cross-shard writes without sharding awareness"}),"\n"]}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Examples (Node.js)"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"const session = client.startSession();\nsession.startTransaction({\n  readConcern: { level: 'snapshot' }, // local | majority | snapshot\n  writeConcern: { w: 'majority' },     // number | 'majority'\n});\n\n// Too many ops can abort transaction\n"})})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"aggregation-limits",children:"Aggregation Limits"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Resource and execution constraints in pipelines"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"100MB memory limit per stage (unless allowDiskUse)"}),"\n",(0,t.jsx)(n.li,{children:"50 stages max"}),"\n",(0,t.jsx)(n.li,{children:"Blocking stages increase latency"}),"\n"]}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Examples (Node.js)"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"await db.collection('orders').aggregate([\n  { $group: { _id: '$userId', total: { $sum: '$amount' } } }\n], {\n  allowDiskUse: true, // boolean\n});\n"})})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"hot-documents",children:"Hot Documents"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Excessive contention on a single document"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Single-document write lock contention"}),"\n",(0,t.jsx)(n.li,{children:"Common with counters and queues"}),"\n",(0,t.jsx)(n.li,{children:"Causes latency spikes"}),"\n"]}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Examples (Node.js)"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// Anti-pattern: single counter doc\nawait db.collection('stats').updateOne(\n  { _id: 'global' },\n  { $inc: { count: 1 } }\n);\n"})})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"massive-arrays",children:"Massive Arrays"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Unbounded array growth inside documents"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Document growth causes relocations"}),"\n",(0,t.jsx)(n.li,{children:"Querying large arrays is expensive"}),"\n",(0,t.jsx)(n.li,{children:"Indexing arrays increases index size"}),"\n"]}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Examples (Node.js)"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// Anti-pattern: ever-growing array\nawait db.collection('users').updateOne(\n  { _id: userId },\n  { $push: { events: event } }\n);\n"})})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"unindexed-queries",children:"Unindexed Queries"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Collection scans due to missing or unusable indexes"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Cause high CPU and IO"}),"\n",(0,t.jsx)(n.li,{children:"Block cache with useless reads"}),"\n",(0,t.jsx)(n.li,{children:"Easily detectable via explain"}),"\n"]}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Examples (Node.js)"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// Collection scan\nawait db.collection('orders').find({ status: 'PENDING' }).toArray();\n\n// Detect\nawait db.collection('orders')\n  .find({ status: 'PENDING' })\n  .explain('executionStats');\n"})})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Most MongoDB outages are self-inflicted"}),"\n",(0,t.jsx)(n.li,{children:"Limits exist to protect cluster stability"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"caveats",children:"Caveats"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Ignoring limits leads to cascading failures"}),"\n",(0,t.jsx)(n.li,{children:'Anti-patterns often appear "fine" at small scale'}),"\n",(0,t.jsx)(n.li,{children:"Always validate with explain and load tests"}),"\n"]})]})}function x(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>o,x:()=>l});var i=s(6540);const t={},r=i.createContext(t);function o(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);