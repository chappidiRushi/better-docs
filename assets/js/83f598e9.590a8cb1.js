"use strict";(globalThis.webpackChunkbetter_docs=globalThis.webpackChunkbetter_docs||[]).push([[5814],{4663(e,n,s){s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"mongo/mongoose-security-considerations","title":"Security Considerations","description":"-----------------","source":"@site/docs/mongo/Mongoose Security Considerations.md","sourceDirName":"mongo","slug":"/mongo/mongoose-security-considerations","permalink":"/better-docs/docs/mongo/mongoose-security-considerations","draft":false,"unlisted":false,"editUrl":"https://github.com/chappidirushi/better-docs/tree/main/docs/mongo/Mongoose Security Considerations.md","tags":[],"version":"current","sidebarPosition":40,"frontMatter":{"id":"mongoose-security-considerations","title":"Security Considerations","sidebar_position":40},"sidebar":"tutorialSidebar","previous":{"title":"Performance and Optimization","permalink":"/better-docs/docs/mongo/mongoose-performance-optimization"},"next":{"title":"Testing and Tooling","permalink":"/better-docs/docs/mongo/mongoose-testing-tooling"}}');var o=s(4848),t=s(8453);const r={id:"mongoose-security-considerations",title:"Security Considerations",sidebar_position:40},a=void 0,l={},c=[{value:"1. Injection Risks",id:"1-injection-risks",level:2},{value:"2. Mass Assignment",id:"2-mass-assignment",level:2},{value:"3. Schema Enforcement Limits",id:"3-schema-enforcement-limits",level:2},{value:"4. Secure Defaults",id:"4-secure-defaults",level:2},{value:"Notes",id:"notes",level:2},{value:"Caveats",id:"caveats",level:2}];function d(e){const n={blockquote:"blockquote",code:"code",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"1-injection-risks",children:"1. Injection Risks"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"MongoDB operator injection via untrusted input"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"$ne | $gt | $where | $regex\n"})}),"\n",(0,o.jsxs)(s,{children:[(0,o.jsx)("summary",{children:"Examples"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'// \u274c vulnerable\nawait User.find({ email: req.body.email }); // user controls object shape\n\n// payload\n{ "email": { "$ne": null } }\n\n// \u2705 safe\nawait User.find({ email: String(req.body.email) });\n\n// strict filtering\nawait User.find({\n  email: { $eq: req.body.email } // explicit operator\n});\n'})})]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"2-mass-assignment",children:"2. Mass Assignment"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Uncontrolled writes via spread or direct body usage"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"Model.create(input)\nModel.updateOne(filter, input)\n"})}),"\n",(0,o.jsxs)(s,{children:[(0,o.jsx)("summary",{children:"Examples"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"// \u274c vulnerable\nawait User.create(req.body);      // role, isAdmin injectable\n\n// \u2705 allowlist\nconst payload = {\n  email: req.body.email,\n  name: req.body.name\n};\n\nawait User.create(payload);\n\n// schema-level protection\nnew Schema({\n  role: { type: String, immutable: true }, // boolean\n  isAdmin: { type: Boolean, select: false }\n});\n"})})]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"3-schema-enforcement-limits",children:"3. Schema Enforcement Limits"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Schema validation is not a security boundary"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"strict | runValidators | overwrite\n"})}),"\n",(0,o.jsxs)(s,{children:[(0,o.jsx)("summary",{children:"Examples"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"// strict mode\nnew Schema({}, {\n  strict: true               // true | false | 'throw'\n});\n\n// update bypass\nawait User.updateOne(\n  { _id: id },\n  { role: 'admin' },         // bypasses unless validated\n  { runValidators: true }    // boolean\n);\n\n// overwrite risk\nawait User.replaceOne(\n  { _id: id },\n  req.body                   // full replacement\n);\n"})})]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"4-secure-defaults",children:"4. Secure Defaults"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Baseline configuration for production safety"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"autoIndex | strictQuery | sanitizeFilter\n"})}),"\n",(0,o.jsxs)(s,{children:[(0,o.jsx)("summary",{children:"Examples"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"// global defaults\nmongoose.set('autoIndex', false);        // boolean\nmongoose.set('strictQuery', true);       // boolean\nmongoose.set('sanitizeFilter', true);    // boolean\n\n// schema defaults\nnew Schema({}, {\n  strict: 'throw',            // reject unknown fields\n  minimize: true              // remove empty objects\n});\n\n// query hardening\nawait User.find(req.query)\n  .select('email name');      // projection allowlist\n"})})]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Mongoose does not sanitize input by default"}),"\n",(0,o.jsx)(n.li,{children:"Schemas protect structure, not intent"}),"\n",(0,o.jsx)(n.li,{children:"Most vulnerabilities originate before Mongoose"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"caveats",children:"Caveats"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"$where"})," enables JS execution \u2014 never expose"]}),"\n",(0,o.jsx)(n.li,{children:"Validation does not prevent logical privilege escalation"}),"\n",(0,o.jsx)(n.li,{children:"Security requires API + DB + schema alignment"}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>r,x:()=>a});var i=s(6540);const o={},t=i.createContext(o);function r(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);