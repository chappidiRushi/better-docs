"use strict";(globalThis.webpackChunkbetter_docs=globalThis.webpackChunkbetter_docs||[]).push([[7527],{1330(e,n,i){i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"mongo/mongodb-performance-optimization","title":"Performance and Optimization","description":"-----------------","source":"@site/docs/mongo/Performance and Optimization.md","sourceDirName":"mongo","slug":"/mongo/mongodb-performance-optimization","permalink":"/better-docs/docs/mongo/mongodb-performance-optimization","draft":false,"unlisted":false,"editUrl":"https://github.com/chappidirushi/better-docs/tree/main/docs/mongo/Performance and Optimization.md","tags":[],"version":"current","sidebarPosition":13,"frontMatter":{"id":"mongodb-performance-optimization","title":"Performance and Optimization","sidebar_position":13},"sidebar":"tutorialSidebar","previous":{"title":"Storage Engine (WiredTiger)","permalink":"/better-docs/docs/mongo/mongodb-wiredtiger"},"next":{"title":"Data Modeling Patterns","permalink":"/better-docs/docs/mongo/mongodb-data-modeling-patterns"}}');var r=i(4848),t=i(8453);const l={id:"mongodb-performance-optimization",title:"Performance and Optimization",sidebar_position:13},o=void 0,d={},c=[{value:"Working Set Model",id:"working-set-model",level:2},{value:"RAM vs Disk Access",id:"ram-vs-disk-access",level:2},{value:"Query Shape Stability",id:"query-shape-stability",level:2},{value:"Index Selectivity",id:"index-selectivity",level:2},{value:"Write Optimization",id:"write-optimization",level:2},{value:"Read Optimization",id:"read-optimization",level:2},{value:"Benchmarking Strategies",id:"benchmarking-strategies",level:2},{value:"Notes",id:"notes",level:2},{value:"Caveats",id:"caveats",level:2}];function a(e){const n={blockquote:"blockquote",code:"code",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components},{Details:i}=n;return i||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"working-set-model",children:"Working Set Model"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Performance depends on how much active data fits in memory"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Working set = frequently accessed data + indexes"}),"\n",(0,r.jsx)(n.li,{children:"Should fit in WiredTiger cache"}),"\n",(0,r.jsx)(n.li,{children:"Cache misses cause disk IO"}),"\n"]}),"\n",(0,r.jsxs)(i,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Inspect cache usage and eviction\nawait adminDb.command({ serverStatus: 1 })\n  .then(r => r.wiredTiger.cache);\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"ram-vs-disk-access",children:"RAM vs Disk Access"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Memory access is orders of magnitude faster than disk"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"RAM hits = microseconds"}),"\n",(0,r.jsx)(n.li,{children:"Disk hits = milliseconds"}),"\n",(0,r.jsx)(n.li,{children:"SSD strongly recommended"}),"\n"]}),"\n",(0,r.jsxs)(i,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Force cold read (anti-pattern)\nawait db.collection('logs')\n  .find({ level: 'error' })\n  .hint({ _id: 1 })\n  .toArray();\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"query-shape-stability",children:"Query Shape Stability"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Consistent query patterns improve plan caching"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Same query shape \u2192 cached plan reuse"}),"\n",(0,r.jsx)(n.li,{children:"Dynamic fields break cache"}),"\n",(0,r.jsx)(n.li,{children:"Avoid unbounded predicates"}),"\n"]}),"\n",(0,r.jsxs)(i,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Stable query shape\nawait db.collection('users').find({ status: 'active' });\n\n// Unstable query shape (anti-pattern)\nawait db.collection('users').find({ [dynamicField]: value });\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"index-selectivity",children:"Index Selectivity"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Highly selective indexes reduce scanned documents"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"High cardinality preferred"}),"\n",(0,r.jsx)(n.li,{children:"Equality before range"}),"\n",(0,r.jsx)(n.li,{children:"Compound index order matters"}),"\n"]}),"\n",(0,r.jsxs)(i,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// High selectivity index\nawait db.collection('users').createIndex({ email: 1 });\n\n// Low selectivity index (anti-pattern)\nawait db.collection('users').createIndex({ isActive: 1 });\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"write-optimization",children:"Write Optimization"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Optimizing throughput and durability tradeoffs"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Batch writes"}),"\n",(0,r.jsx)(n.li,{children:"Minimize index count"}),"\n",(0,r.jsx)(n.li,{children:"Use unordered bulk ops"}),"\n"]}),"\n",(0,r.jsxs)(i,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"await db.collection('events').insertMany(docs, {\n  ordered: false // boolean\n});\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"read-optimization",children:"Read Optimization"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Reducing latency and IO for read-heavy workloads"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Covered queries"}),"\n",(0,r.jsx)(n.li,{children:"Projection reduction"}),"\n",(0,r.jsx)(n.li,{children:"Read from secondaries if allowed"}),"\n"]}),"\n",(0,r.jsxs)(i,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"await db.collection('users').find(\n  { email: 'a@x.com' },\n  { projection: { _id: 0, email: 1 } }\n).hint({ email: 1 });\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"benchmarking-strategies",children:"Benchmarking Strategies"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Measuring real-world performance correctly"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Test production-like data"}),"\n",(0,r.jsx)(n.li,{children:"Warm cache before measuring"}),"\n",(0,r.jsx)(n.li,{children:"Measure p95 / p99 latency"}),"\n"]}),"\n",(0,r.jsxs)(i,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"console.time('query');\nawait db.collection('orders').find({ status: 'paid' }).toArray();\nconsole.timeEnd('query');\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Performance is workload-dependent"}),"\n",(0,r.jsx)(n.li,{children:"Schema and index design dominate outcomes"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"caveats",children:"Caveats"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Over-indexing hurts writes"}),"\n",(0,r.jsx)(n.li,{children:"Cache misses dominate latency"}),"\n",(0,r.jsx)(n.li,{children:"Benchmarks without warmup are misleading"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453(e,n,i){i.d(n,{R:()=>l,x:()=>o});var s=i(6540);const r={},t=s.createContext(r);function l(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);