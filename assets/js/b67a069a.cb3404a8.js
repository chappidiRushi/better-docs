"use strict";(globalThis.webpackChunkbetter_docs=globalThis.webpackChunkbetter_docs||[]).push([[395],{7726(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>d,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"mongo/mongodb-crud","title":"CRUD Operations","description":"----------------","source":"@site/docs/mongo/CURD Operations.md","sourceDirName":"mongo","slug":"/mongo/mongodb-crud","permalink":"/better-docs/docs/mongo/mongodb-crud","draft":false,"unlisted":false,"editUrl":"https://github.com/chappidirushi/better-docs/tree/main/docs/mongo/CURD Operations.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"id":"mongodb-crud","title":"CRUD Operations","sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Documents, Collections, and Schema Design","permalink":"/better-docs/docs/mongo/mongodb-documents-schema"},"next":{"title":"Query Execution Engine","permalink":"/better-docs/docs/mongo/mongodb-query-execution-engine"}}');var r=s(4848),l=s(8453);const d={id:"mongodb-crud",title:"CRUD Operations",sidebar_position:5},t=void 0,c={},a=[{value:"Insert Semantics",id:"insert-semantics",level:2},{value:"Query Filters",id:"query-filters",level:2},{value:"Projection",id:"projection",level:2},{value:"Sorting and Pagination",id:"sorting-and-pagination",level:2},{value:"Update Operators",id:"update-operators",level:2},{value:"Replace vs Update",id:"replace-vs-update",level:2},{value:"Delete Semantics",id:"delete-semantics",level:2},{value:"Bulk Operations",id:"bulk-operations",level:2},{value:"Atomicity Guarantees",id:"atomicity-guarantees",level:2},{value:"Upserts",id:"upserts",level:2},{value:"findOneAnd* Operations",id:"findoneand-operations",level:2},{value:"Write Concern",id:"write-concern",level:2},{value:"Read Concern and Read Preference",id:"read-concern-and-read-preference",level:2},{value:"Collation",id:"collation",level:2},{value:"Hints and Explain",id:"hints-and-explain",level:2},{value:"Notes",id:"notes",level:2},{value:"Caveats",id:"caveats",level:2}];function o(e){const n={blockquote:"blockquote",code:"code",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"insert-semantics",children:"Insert Semantics"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Inserts are atomic per document; no implicit upserts"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Facts"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Single-document atomicity"}),"\n",(0,r.jsx)(n.li,{children:"Ordered vs unordered inserts"}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"_id"})," required (auto-generated if missing)"]}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// insertOne\nawait db.collection('users').insertOne(\n  { _id: 1, name: 'A' },\n  { writeConcern: { w: 'majority', j: true } } // writeConcern\n);\n\n// insertMany\nawait db.collection('users').insertMany(\n  [{ _id: 2 }, { _id: 3 }],\n  { ordered: false } // boolean\n);\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"query-filters",children:"Query Filters"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Predicate expressions evaluated via query planner"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Capabilities"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Field operators"}),"\n",(0,r.jsx)(n.li,{children:"Logical operators"}),"\n",(0,r.jsx)(n.li,{children:"Array and element matching"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Simple filter\nawait db.collection('users').find({ age: { $gte: 18 } }).toArray();\n\n// Logical operators\nawait db.collection('users').find({\n  $and: [\n    { status: 'active' },\n    { age: { $lt: 50 } }\n  ]\n}).toArray();\n\n// Array match\nawait db.collection('users').find({ roles: { $in: ['admin', 'mod'] } }).toArray();\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"projection",children:"Projection"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Shape control for returned documents"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Rules"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Inclusion or exclusion (not both, except ",(0,r.jsx)(n.code,{children:"_id"}),")"]}),"\n",(0,r.jsx)(n.li,{children:"Reduces network and decode cost"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Inclusion projection\nawait db.collection('users')\n  .find({}, { projection: { name: 1, email: 1 } })\n  .toArray();\n\n// Exclusion projection\nawait db.collection('users')\n  .find({}, { projection: { password: 0 } })\n  .toArray();\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"sorting-and-pagination",children:"Sorting and Pagination"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Deterministic ordering requires index support"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Notes"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Sort without index = blocking"}),"\n",(0,r.jsx)(n.li,{children:"Prefer range-based pagination"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Sort + limit\nawait db.collection('users')\n  .find({})\n  .sort({ createdAt: -1 }) // 1 | -1\n  .limit(10)\n  .toArray();\n\n// Pagination with skip (anti-pattern at scale)\nawait db.collection('users')\n  .find({})\n  .skip(20)\n  .limit(10)\n  .toArray();\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"update-operators",children:"Update Operators"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"In-place mutations without document replacement"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Categories"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Field: ",(0,r.jsx)(n.code,{children:"$set"}),", ",(0,r.jsx)(n.code,{children:"$unset"}),", ",(0,r.jsx)(n.code,{children:"$inc"})]}),"\n",(0,r.jsxs)(n.li,{children:["Array: ",(0,r.jsx)(n.code,{children:"$push"}),", ",(0,r.jsx)(n.code,{children:"$pull"}),", ",(0,r.jsx)(n.code,{children:"$addToSet"})]}),"\n",(0,r.jsxs)(n.li,{children:["Conditional: ",(0,r.jsx)(n.code,{children:"$min"}),", ",(0,r.jsx)(n.code,{children:"$max"})]}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Field update\nawait db.collection('users').updateOne(\n  { _id: 1 },\n  { $set: { status: 'active' }, $inc: { loginCount: 1 } }\n);\n\n// Array update\nawait db.collection('users').updateOne(\n  { _id: 1 },\n  { $addToSet: { roles: 'admin' } }\n);\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"replace-vs-update",children:"Replace vs Update"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Replace overwrites document; update mutates fields"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Differences"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"replaceOne"})," removes unspecified fields"]}),"\n",(0,r.jsx)(n.li,{children:"Update operators preserve others"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// replaceOne (full overwrite)\nawait db.collection('users').replaceOne(\n  { _id: 1 },\n  { name: 'A', status: 'active' }\n);\n\n// updateOne (partial)\nawait db.collection('users').updateOne(\n  { _id: 1 },\n  { $set: { status: 'inactive' } }\n);\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"delete-semantics",children:"Delete Semantics"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Deletes are immediate and non-recoverable"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Notes"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"No soft delete by default"}),"\n",(0,r.jsx)(n.li,{children:"Indexes affect delete performance"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// deleteOne\nawait db.collection('users').deleteOne({ _id: 1 });\n\n// deleteMany\nawait db.collection('users').deleteMany({ status: 'inactive' });\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"bulk-operations",children:"Bulk Operations"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"High-throughput batched writes"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Characteristics"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Ordered or unordered"}),"\n",(0,r.jsx)(n.li,{children:"Partial success possible"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"await db.collection('users').bulkWrite([\n  { insertOne: { document: { _id: 10 } } },\n  { updateOne: {\n      filter: { _id: 2 },\n      update: { $set: { status: 'active' } },\n      upsert: true // boolean\n  }},\n  { deleteOne: { filter: { _id: 3 } } }\n], {\n  ordered: false // boolean\n});\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"atomicity-guarantees",children:"Atomicity Guarantees"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Atomic at single-document level; multi-doc via transactions"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Guarantees"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Single-document writes are atomic"}),"\n",(0,r.jsx)(n.li,{children:"Isolation across documents not guaranteed"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Atomic single-document update\nawait db.collection('accounts').updateOne(\n  { _id: 1, balance: { $gte: 100 } },\n  { $inc: { balance: -100 } }\n);\n\n// Multi-document transaction\nconst session = client.startSession();\nawait session.withTransaction(async () => {\n  await db.collection('a').updateOne({ _id: 1 }, { $inc: { v: -1 } }, { session });\n  await db.collection('b').updateOne({ _id: 1 }, { $inc: { v: 1 } }, { session });\n});\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"upserts",children:"Upserts"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Insert-or-update semantics controlled explicitly"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Facts"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Disabled by default"}),"\n",(0,r.jsx)(n.li,{children:"Insert path applies update operators"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"await db.collection('users').updateOne(\n  { email: 'a@x.com' },\n  { $set: { name: 'A' }, $setOnInsert: { createdAt: new Date() } },\n  { upsert: true } // boolean\n);\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"findoneand-operations",children:"findOneAnd* Operations"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Read-modify-write with server-side atomicity"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Variants"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"findOneAndUpdate"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"findOneAndReplace"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"findOneAndDelete"})}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"await db.collection('jobs').findOneAndUpdate(\n  { status: 'pending' },\n  { $set: { status: 'processing' } },\n  {\n    sort: { priority: -1 },     // sort order\n    returnDocument: 'after',    // 'before' | 'after'\n    projection: { _id: 1 }      // object\n  }\n);\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"write-concern",children:"Write Concern"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Durability guarantees for writes"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Levels"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"w: 1"})," (default)"]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"w: 'majority'"})}),"\n",(0,r.jsx)(n.li,{children:"Journaling control"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"await db.collection('orders').insertOne(\n  { _id: 1 },\n  {\n    writeConcern: {\n      w: 'majority', // number | 'majority'\n      j: true,       // boolean\n      wtimeout: 5000 // ms\n    }\n  }\n);\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"read-concern-and-read-preference",children:"Read Concern and Read Preference"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Consistency and replica targeting for reads"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Read Concern"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"local"}),", ",(0,r.jsx)(n.code,{children:"majority"}),", ",(0,r.jsx)(n.code,{children:"snapshot"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Read Preference"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"primary"}),", ",(0,r.jsx)(n.code,{children:"secondary"}),", ",(0,r.jsx)(n.code,{children:"nearest"})]}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"await db.collection('users').find(\n  {},\n  {\n    readConcern: { level: 'majority' }, // 'local' | 'majority' | 'snapshot'\n    readPreference: 'secondaryPreferred' // string\n  }\n).toArray();\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"collation",children:"Collation"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Locale-aware string comparison"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Uses"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Case-insensitive queries"}),"\n",(0,r.jsx)(n.li,{children:"Language-specific sorting"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"await db.collection('users').find(\n  { name: 'alex' },\n  {\n    collation: {\n      locale: 'en',\n      strength: 2 // case-insensitive\n    }\n  }\n).toArray();\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"hints-and-explain",children:"Hints and Explain"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Query planner control and introspection"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Force index usage\nawait db.collection('users')\n  .find({ email: 'a@x.com' })\n  .hint({ email: 1 })\n  .toArray();\n\n// Explain plan\nawait db.collection('users')\n  .find({ age: { $gt: 30 } })\n  .explain('executionStats'); // 'queryPlanner' | 'executionStats'\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["CRUD semantics are ",(0,r.jsx)(n.strong,{children:"simple but sharp-edged"})]}),"\n",(0,r.jsx)(n.li,{children:"Indexes dominate read & write behavior"}),"\n",(0,r.jsx)(n.li,{children:"Most bugs come from misunderstood filters"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"caveats",children:"Caveats"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Updates without operators cause replacement"}),"\n",(0,r.jsx)(n.li,{children:"Skip-based pagination does not scale"}),"\n",(0,r.jsx)(n.li,{children:"Bulk writes can partially succeed"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},8453(e,n,s){s.d(n,{R:()=>d,x:()=>t});var i=s(6540);const r={},l=i.createContext(r);function d(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);