"use strict";(globalThis.webpackChunkbetter_docs=globalThis.webpackChunkbetter_docs||[]).push([[3380],{8453(e,n,s){s.d(n,{R:()=>l,x:()=>t});var i=s(6540);const r={},d=i.createContext(r);function l(e){const n=i.useContext(d);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(d.Provider,{value:n},e.children)}},9927(e,n,s){s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>x,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"mongo/mongodb-indexing-system","title":"Indexing System","description":"----------------","source":"@site/docs/mongo/Indexing System.md","sourceDirName":"mongo","slug":"/mongo/mongodb-indexing-system","permalink":"/better-docs/docs/mongo/mongodb-indexing-system","draft":false,"unlisted":false,"editUrl":"https://github.com/chappidirushi/better-docs/tree/main/docs/mongo/Indexing System.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"id":"mongodb-indexing-system","title":"Indexing System","sidebar_position":7},"sidebar":"tutorialSidebar","previous":{"title":"Query Execution Engine","permalink":"/better-docs/docs/mongo/mongodb-query-execution-engine"},"next":{"title":"Aggregation Framework","permalink":"/better-docs/docs/mongo/mongodb-aggregation-framework"}}');var r=s(4848),d=s(8453);const l={id:"mongodb-indexing-system",title:"Indexing System",sidebar_position:7},t=void 0,o={},c=[{value:"Index Internals",id:"index-internals",level:2},{value:"Single and Compound Indexes",id:"single-and-compound-indexes",level:2},{value:"Multikey Indexes",id:"multikey-indexes",level:2},{value:"Index Prefix Rules",id:"index-prefix-rules",level:2},{value:"Text Indexes",id:"text-indexes",level:2},{value:"Geospatial Indexes",id:"geospatial-indexes",level:2},{value:"Partial and Sparse Indexes",id:"partial-and-sparse-indexes",level:2},{value:"TTL Indexes",id:"ttl-indexes",level:2},{value:"Index Build Strategies",id:"index-build-strategies",level:2},{value:"Index Performance Tuning",id:"index-performance-tuning",level:2},{value:"Notes",id:"notes",level:2},{value:"Caveats",id:"caveats",level:2}];function a(e){const n={blockquote:"blockquote",code:"code",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,d.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"index-internals",children:"Index Internals"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Indexes are ordered data structures mapping keys to document locations"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Implemented as B-Trees (WiredTiger)"}),"\n",(0,r.jsx)(n.li,{children:"Store key + record pointer"}),"\n",(0,r.jsx)(n.li,{children:"Separate from collection data"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Create basic index\nawait db.collection('users').createIndex({ email: 1 }); // 1 | -1\n\n// Inspect indexes\nawait db.collection('users').indexes();\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"single-and-compound-indexes",children:"Single and Compound Indexes"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Single-field vs multi-field ordered indexes"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Compound index order matters"}),"\n",(0,r.jsx)(n.li,{children:"Supports equality + range queries"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Single-field index\nawait db.collection('users').createIndex({ age: 1 });\n\n// Compound index\nawait db.collection('users').createIndex({ status: 1, createdAt: -1 });\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"multikey-indexes",children:"Multikey Indexes"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Indexes on array fields"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"One index entry per array element"}),"\n",(0,r.jsx)(n.li,{children:"Cannot compound on multiple array fields"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Array field index\nawait db.collection('users').createIndex({ roles: 1 });\n\n// Query uses multikey index\nawait db.collection('users').find({ roles: 'admin' }).toArray();\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"index-prefix-rules",children:"Index Prefix Rules"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Leftmost prefix determines usability of compound indexes"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Queries must include leading fields"}),"\n",(0,r.jsx)(n.li,{children:"Skipping breaks index usage"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Index\nawait db.collection('orders').createIndex({ userId: 1, createdAt: 1, status: 1 });\n\n// Uses index (prefix)\nawait db.collection('orders').find({ userId: 1, createdAt: { $gt: new Date() } });\n\n// Does NOT use index (skips prefix)\nawait db.collection('orders').find({ status: 'open' });\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"text-indexes",children:"Text Indexes"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Full-text search with language-specific tokenization"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"One text index per collection"}),"\n",(0,r.jsx)(n.li,{children:"Uses inverted index"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Create text index\nawait db.collection('articles').createIndex({ title: 'text', body: 'text' });\n\n// Text search\nawait db.collection('articles').find({ $text: { $search: 'mongodb index' } }).toArray();\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"geospatial-indexes",children:"Geospatial Indexes"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Spatial queries on coordinate data"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"2dsphere"})," for Earth-like geometry"]}),"\n",(0,r.jsx)(n.li,{children:"Supports $near, $geoWithin"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// 2dsphere index\nawait db.collection('places').createIndex({ location: '2dsphere' });\n\n// Geo query\nawait db.collection('places').find({\n  location: {\n    $near: {\n      $geometry: { type: 'Point', coordinates: [77.6, 12.9] },\n      $maxDistance: 5000 // meters\n    }\n  }\n}).toArray();\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"partial-and-sparse-indexes",children:"Partial and Sparse Indexes"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Index only a subset of documents"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Sparse: only documents with field"}),"\n",(0,r.jsx)(n.li,{children:"Partial: conditional filter expression"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Sparse index\nawait db.collection('users').createIndex({ email: 1 }, { sparse: true });\n\n// Partial index\nawait db.collection('users').createIndex(\n  { status: 1 },\n  { partialFilterExpression: { status: 'active' } }\n);\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"ttl-indexes",children:"TTL Indexes"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Automatic document expiration"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Background deletion"}),"\n",(0,r.jsx)(n.li,{children:"Not precise to the second"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// TTL index\nawait db.collection('sessions').createIndex(\n  { expiresAt: 1 },\n  { expireAfterSeconds: 0 } // seconds\n);\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"index-build-strategies",children:"Index Build Strategies"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"How indexes are created without blocking"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Foreground vs background (pre-4.2)"}),"\n",(0,r.jsx)(n.li,{children:"Online index builds"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Online index build (default)\nawait db.collection('users').createIndex({ lastLogin: -1 });\n\n// Rolling index build strategy\n// Build on secondaries \u2192 step up primary\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"index-performance-tuning",children:"Index Performance Tuning"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Designing indexes for planner efficiency"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Match query patterns"}),"\n",(0,r.jsx)(n.li,{children:"Avoid unused indexes"}),"\n",(0,r.jsx)(n.li,{children:"Monitor with explain"}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Force index usage\nawait db.collection('users')\n  .find({ email: 'a@x.com' })\n  .hint({ email: 1 })\n  .explain('executionStats');\n\n// Drop unused index\nawait db.collection('users').dropIndex({ age: 1 });\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Indexes trade write performance for read speed"}),"\n",(0,r.jsx)(n.li,{children:"Planner decisions depend entirely on indexes"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"caveats",children:"Caveats"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Over-indexing slows writes"}),"\n",(0,r.jsx)(n.li,{children:"Wrong index order negates usefulness"}),"\n",(0,r.jsx)(n.li,{children:"Multikey indexes have strict limitations"}),"\n"]})]})}function x(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}}}]);