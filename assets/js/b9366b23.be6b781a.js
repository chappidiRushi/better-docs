"use strict";(globalThis.webpackChunkbetter_docs=globalThis.webpackChunkbetter_docs||[]).push([[2782],{1215(e,n,t){t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"mongo/mongoose-serialization-output","title":"Serialization and Output","description":"-----------------","source":"@site/docs/mongo/Mongoose Serializetion and Output.md","sourceDirName":"mongo","slug":"/mongo/mongoose-serialization-output","permalink":"/better-docs/docs/mongo/mongoose-serialization-output","draft":false,"unlisted":false,"editUrl":"https://github.com/chappidirushi/better-docs/tree/main/docs/mongo/Mongoose Serializetion and Output.md","tags":[],"version":"current","sidebarPosition":37,"frontMatter":{"id":"mongoose-serialization-output","title":"Serialization and Output","sidebar_position":37},"sidebar":"tutorialSidebar","previous":{"title":"Delete Operations","permalink":"/better-docs/docs/mongo/mongoose-delete-operations"},"next":{"title":"Error Handling","permalink":"/better-docs/docs/mongo/mongoose-error-handling"}}');var o=t(4848),i=t(8453);const r={id:"mongoose-serialization-output",title:"Serialization and Output",sidebar_position:37},l=void 0,a={},c=[{value:"1. <code>toObject()</code> vs <code>toJSON()</code>",id:"1-toobject-vs-tojson",level:2},{value:"2. Transform Functions",id:"2-transform-functions",level:2},{value:"3. Hiding Fields",id:"3-hiding-fields",level:2},{value:"4. Virtuals in Output",id:"4-virtuals-in-output",level:2},{value:"Notes",id:"notes",level:2},{value:"Caveats",id:"caveats",level:2}];function d(e){const n={blockquote:"blockquote",code:"code",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.h2,{id:"1-toobject-vs-tojson",children:["1. ",(0,o.jsx)(n.code,{children:"toObject()"})," vs ",(0,o.jsx)(n.code,{children:"toJSON()"})]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Convert hydrated documents into plain representations"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"doc.toObject(options?)   // \u2192 Object\ndoc.toJSON(options?)     // \u2192 Object (used by JSON.stringify)\n"})}),"\n",(0,o.jsxs)(t,{children:[(0,o.jsx)("summary",{children:"Examples"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"const doc = await User.findById(id);\n\n// toObject\nconst obj = doc.toObject({\n  getters: false,        // boolean\n  virtuals: false,      // boolean\n  depopulate: false,    // boolean\n  versionKey: true      // boolean | string\n});\n\n// toJSON (implicit)\nJSON.stringify(doc);     // calls toJSON internally\n"})})]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"2-transform-functions",children:"2. Transform Functions"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Mutate output shape during serialization"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"{ toObject: { transform }, toJSON: { transform } }\n"})}),"\n",(0,o.jsxs)(t,{children:[(0,o.jsx)("summary",{children:"Examples"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"const schema = new Schema({}, {\n  toJSON: {\n    virtuals: true,\n    transform(doc, ret, options) {\n      delete ret._id;             // any mutation\n      ret.id = doc._id.toString();\n      return ret;                 // object | undefined\n    }\n  },\n  toObject: {\n    transform(doc, ret) {\n      ret.safe = true;\n    }\n  }\n});\n"})})]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"3-hiding-fields",children:"3. Hiding Fields"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Exclude sensitive or internal fields from output"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"select: false | transform | delete\n"})}),"\n",(0,o.jsxs)(t,{children:[(0,o.jsx)("summary",{children:"Examples"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"// schema-level\nconst schema = new Schema({\n  password: { type: String, select: false }, // boolean\n  token: String\n});\n\n// transform-based\nschema.set('toJSON', {\n  transform(doc, ret) {\n    delete ret.token;             // manual removal\n  }\n});\n\n// query-level override\nawait User.findOne({ email }).select('+password'); // include explicitly\n"})})]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"4-virtuals-in-output",children:"4. Virtuals in Output"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Computed fields not persisted in MongoDB"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"schema.virtual(name).get(fn)\n"})}),"\n",(0,o.jsxs)(t,{children:[(0,o.jsx)("summary",{children:"Examples"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"const schema = new Schema({\n  firstName: String,\n  lastName: String\n}, {\n  toJSON: { virtuals: true },     // boolean\n  toObject: { virtuals: true }    // boolean\n});\n\nschema.virtual('fullName').get(function () {\n  return `${this.firstName} ${this.lastName}`;\n});\n\nconst user = await User.findOne();\nuser.toJSON();                    // includes fullName\n"})})]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"toJSON"})," is used implicitly by ",(0,o.jsx)(n.code,{children:"res.json"})," and ",(0,o.jsx)(n.code,{children:"JSON.stringify"})]}),"\n",(0,o.jsx)(n.li,{children:"Transforms run after getters and virtuals"}),"\n",(0,o.jsx)(n.li,{children:"Virtuals never persist to the database"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"caveats",children:"Caveats"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Lean queries bypass document serialization"}),"\n",(0,o.jsx)(n.li,{children:"Transform functions run per document (costly in large arrays)"}),"\n",(0,o.jsx)(n.li,{children:"Hidden fields can still be queried explicitly"}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453(e,n,t){t.d(n,{R:()=>r,x:()=>l});var s=t(6540);const o={},i=s.createContext(o);function r(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);