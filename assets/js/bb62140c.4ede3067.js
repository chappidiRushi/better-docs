"use strict";(globalThis.webpackChunkbetter_docs=globalThis.webpackChunkbetter_docs||[]).push([[1663],{361(e,r,n){n.r(r),n.d(r,{assets:()=>i,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"node/workerthreads","title":"worker_threads Module","description":"Run JavaScript in parallel threads with shared memory","source":"@site/docs/node/workerthreads.md","sourceDirName":"node","slug":"/node/workerthreads","permalink":"/better-docs/docs/node/workerthreads","draft":false,"unlisted":false,"editUrl":"https://github.com/chappidirushi/better-docs/tree/main/docs/node/workerthreads.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"util Module","permalink":"/better-docs/docs/node/util"},"next":{"title":"React","permalink":"/better-docs/docs/react/"}}');var a=n(4848),o=n(8453);const t={},d="worker_threads Module",i={},l=[{value:"Import (ESM)",id:"import-esm",level:2},{value:"Thread Info",id:"thread-info",level:2},{value:"Worker Class",id:"worker-class",level:2},{value:"Worker Properties",id:"worker-properties",level:2},{value:"Worker Methods",id:"worker-methods",level:2},{value:"Worker Events",id:"worker-events",level:2},{value:"MessageChannel / MessagePort",id:"messagechannel--messageport",level:2},{value:"Shared Memory",id:"shared-memory",level:2},{value:"Notes",id:"notes",level:2}];function c(e){const r={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components},{Details:n}=r;return n||function(e,r){throw new Error("Expected "+(r?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.header,{children:(0,a.jsxs)(r.h1,{id:"worker_threads-module",children:[(0,a.jsx)(r.code,{children:"worker_threads"})," Module"]})}),"\n",(0,a.jsxs)(r.blockquote,{children:["\n",(0,a.jsx)(r.p,{children:"Run JavaScript in parallel threads with shared memory"}),"\n"]}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsx)(r.h2,{id:"import-esm",children:"Import (ESM)"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-js",children:"import { Worker, isMainThread, parentPort, workerData, threadId, MessageChannel, MessagePort, receiveMessageOnPort} from 'node:worker_threads';\n"})}),"\n",(0,a.jsxs)(n,{children:[(0,a.jsx)("summary",{children:"Examples"}),(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-js",children:"import { Worker, isMainThread, parentPort } from 'node:worker_threads';\n"})})]}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsx)(r.h2,{id:"thread-info",children:"Thread Info"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-js",children:"// True if running in main thread\nisMainThread                 // boolean\n// Unique thread identifier\nthreadId                     // number\n// Data passed from main thread\nworkerData                   // any\n// Message port to parent\nparentPort                   // MessagePort | null\n"})}),"\n",(0,a.jsxs)(n,{children:[(0,a.jsx)("summary",{children:"Examples"}),(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-js",children:"isMainThread;                 // boolean\nthreadId;                     // id\nworkerData;                   // initial data\nparentPort?.postMessage('hi');\n"})})]}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsx)(r.h2,{id:"worker-class",children:"Worker Class"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-js",children:"// Create a new worker thread\nnew Worker(filename, options?) // (string|URL, object?) \u2192 Worker\n"})}),"\n",(0,a.jsxs)(n,{children:[(0,a.jsx)("summary",{children:"Examples"}),(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-js",children:"new Worker('./worker.js', {\n  workerData: { a: 1 },        // initial data\n  env: process.env,            // env vars\n  execArgv: ['--inspect'],     // node flags\n  argv: ['x', 'y'],            // argv for worker\n  stdin: false,                // inherit stdin\n  stdout: true,                // pipe stdout\n  stderr: true,                // pipe stderr\n  resourceLimits: {            // memory limits\n    maxOldGenerationSizeMb: 64\n  }\n});\n"})})]}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsx)(r.h2,{id:"worker-properties",children:"Worker Properties"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-js",children:"worker.threadId              // number \u2014 worker id\nworker.resourceLimits        // object \u2014 applied limits\nworker.stdin                 // Writable | null\nworker.stdout                // Readable | null\nworker.stderr                // Readable | null\n"})}),"\n",(0,a.jsxs)(n,{children:[(0,a.jsx)("summary",{children:"Examples"}),(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-js",children:"const w = new Worker('./w.js');\nw.threadId;\nw.stdout?.on('data', d => {});\n"})})]}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsx)(r.h2,{id:"worker-methods",children:"Worker Methods"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-js",children:"// Send message to worker\nworker.postMessage(value, transferList?) // (any, Array?) \u2192 void\n// Terminate worker\nworker.terminate()            // () \u2192 Promise<number>\n// Add event listener\nworker.on(event, listener)    // (string, Function) \u2192 this\n"})}),"\n",(0,a.jsxs)(n,{children:[(0,a.jsx)("summary",{children:"Examples"}),(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-js",children:"worker.postMessage({ cmd: 'run' }, []); // message, transferList\nawait worker.terminate();               // terminate\nworker.on('message', msg => {});        // event\n"})})]}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsx)(r.h2,{id:"worker-events",children:"Worker Events"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-js",children:"worker.on('message', listener) // (any) \u2192 void\nworker.on('error', listener)   // (Error) \u2192 void\nworker.on('exit', listener)    // (number) \u2192 void\nworker.on('online', listener)  // () \u2192 void\n"})}),"\n",(0,a.jsxs)(n,{children:[(0,a.jsx)("summary",{children:"Examples"}),(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-js",children:"worker.on('message', msg => {});\nworker.on('error', err => {});\nworker.on('exit', code => {});\nworker.on('online', () => {});\n"})})]}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsx)(r.h2,{id:"messagechannel--messageport",children:"MessageChannel / MessagePort"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-js",children:"// Create a message channel\nnew MessageChannel()           // () \u2192 { port1, port2 }\n// Message port for communication\nMessagePort                    // class\n// Receive message synchronously\nreceiveMessageOnPort(port)     // (MessagePort) \u2192 { message } | undefined\n"})}),"\n",(0,a.jsxs)(n,{children:[(0,a.jsx)("summary",{children:"Examples"}),(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-js",children:"const { port1, port2 } = new MessageChannel();\nport1.postMessage('hi');\nreceiveMessageOnPort(port2);   // sync receive\n"})})]}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsx)(r.h2,{id:"shared-memory",children:"Shared Memory"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-js",children:"// Shared memory buffer\nnew SharedArrayBuffer(length)  // (number) \u2192 SharedArrayBuffer\n// Atomic operations\nAtomics.add(view, index, value)// (TypedArray, number, number) \u2192 number\n"})}),"\n",(0,a.jsxs)(n,{children:[(0,a.jsx)("summary",{children:"Examples"}),(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-js",children:"const sab = new SharedArrayBuffer(1024); // bytes\nconst view = new Int32Array(sab);\nAtomics.add(view, 0, 1);                 // atomic op\n"})})]}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsx)(r.h2,{id:"notes",children:"Notes"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:"Threads share memory, not event loop"}),"\n",(0,a.jsxs)(r.li,{children:["Use ",(0,a.jsx)(r.code,{children:"SharedArrayBuffer"})," + ",(0,a.jsx)(r.code,{children:"Atomics"})," for sync"]}),"\n",(0,a.jsxs)(r.li,{children:["Better than ",(0,a.jsx)(r.code,{children:"child_process"})," for CPU-bound work"]}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,a.jsx)(r,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},8453(e,r,n){n.d(r,{R:()=>t,x:()=>d});var s=n(6540);const a={},o=s.createContext(a);function t(e){const r=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function d(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),s.createElement(o.Provider,{value:r},e.children)}}}]);