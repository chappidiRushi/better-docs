"use strict";(globalThis.webpackChunkbetter_docs=globalThis.webpackChunkbetter_docs||[]).push([[7026],{8453(n,e,o){o.d(e,{R:()=>r,x:()=>t});var s=o(6540);const i={},c=s.createContext(i);function r(n){const e=s.useContext(c);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:r(n.components),s.createElement(c.Provider,{value:e},n.children)}},9375(n,e,o){o.r(e),o.d(e,{assets:()=>l,contentTitle:()=>t,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"mongo/mongoose-connections-topology","title":"Mongoose Connections and Topology","description":"-----------------","source":"@site/docs/mongo/Mongoose Connection.md","sourceDirName":"mongo","slug":"/mongo/mongoose-connections-topology","permalink":"/better-docs/docs/mongo/mongoose-connections-topology","draft":false,"unlisted":false,"editUrl":"https://github.com/chappidirushi/better-docs/tree/main/docs/mongo/Mongoose Connection.md","tags":[],"version":"current","sidebarPosition":24,"frontMatter":{"id":"mongoose-connections-topology","title":"Mongoose Connections and Topology","sidebar_position":24},"sidebar":"tutorialSidebar","previous":{"title":"Mongoose Architecture and Core Concepts","permalink":"/better-docs/docs/mongo/mongoose-architecture-core-concepts"},"next":{"title":"Mongoose Schemas and SchemaTypes","permalink":"/better-docs/docs/mongo/mongoose-schemas-schematypes"}}');var i=o(4848),c=o(8453);const r={id:"mongoose-connections-topology",title:"Mongoose Connections and Topology",sidebar_position:24},t=void 0,l={},d=[{value:"Connection Lifecycle",id:"connection-lifecycle",level:2},{value:"Connection Pooling",id:"connection-pooling",level:2},{value:"Multiple Connections",id:"multiple-connections",level:2},{value:"Replica Sets and Shards",id:"replica-sets-and-shards",level:2},{value:"Read and Write Concerns",id:"read-and-write-concerns",level:2},{value:"Graceful Shutdown",id:"graceful-shutdown",level:2},{value:"Notes",id:"notes",level:2},{value:"Caveats",id:"caveats",level:2}];function a(n){const e={blockquote:"blockquote",code:"code",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...n.components},{Details:o}=e;return o||function(n,e){throw new Error("Expected "+(e?"component":"object")+" `"+n+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h2,{id:"connection-lifecycle",children:"Connection Lifecycle"}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:"Establishment, readiness, error handling, and teardown of connections"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Interview points"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Built on top of MongoDB Node.js driver"}),"\n",(0,i.jsx)(e.li,{children:"Connection state machine (connecting \u2192 connected \u2192 disconnected)"}),"\n",(0,i.jsx)(e.li,{children:"Emits lifecycle events"}),"\n"]}),"\n",(0,i.jsxs)(o,{children:[(0,i.jsx)("summary",{children:"Examples (Node.js)"}),(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-js",children:"import mongoose from 'mongoose';\n\nmongoose.connection.on('connected', () => console.log('connected'));\nmongoose.connection.on('error', err => console.error(err));\nmongoose.connection.on('disconnected', () => console.log('disconnected'));\n\nawait mongoose.connect('mongodb://localhost:27017/app');\n"})})]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"connection-pooling",children:"Connection Pooling"}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:"Reuse of TCP connections for concurrent operations"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Interview points"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Pool per server"}),"\n",(0,i.jsx)(e.li,{children:"Controlled via driver options"}),"\n",(0,i.jsx)(e.li,{children:"Prevents connection thrashing"}),"\n"]}),"\n",(0,i.jsxs)(o,{children:[(0,i.jsx)("summary",{children:"Examples (Node.js)"}),(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-js",children:"await mongoose.connect(uri, {\n  maxPoolSize: 20,        // number\n  minPoolSize: 5,         // number\n  maxIdleTimeMS: 30000,   // number\n  waitQueueTimeoutMS: 5000, // number\n});\n"})})]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"multiple-connections",children:"Multiple Connections"}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:"Managing separate connections for isolation or multi-tenancy"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Interview points"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Each connection has its own models"}),"\n",(0,i.jsx)(e.li,{children:"Avoids cross-database contamination"}),"\n",(0,i.jsx)(e.li,{children:"Useful for sharding by tenant"}),"\n"]}),"\n",(0,i.jsxs)(o,{children:[(0,i.jsx)("summary",{children:"Examples (Node.js)"}),(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-js",children:"const connA = mongoose.createConnection('mongodb://localhost:27017/dbA');\nconst connB = mongoose.createConnection('mongodb://localhost:27017/dbB');\n\nconst UserA = connA.model('User', userSchema);\nconst UserB = connB.model('User', userSchema);\n"})})]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"replica-sets-and-shards",children:"Replica Sets and Shards"}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:"Awareness of MongoDB cluster topology"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Interview points"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Topology handled by driver SDAM"}),"\n",(0,i.jsx)(e.li,{children:"Automatic primary discovery"}),"\n",(0,i.jsx)(e.li,{children:"Mongoose is topology-agnostic"}),"\n"]}),"\n",(0,i.jsxs)(o,{children:[(0,i.jsx)("summary",{children:"Examples (Node.js)"}),(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-js",children:"await mongoose.connect('mongodb://n1,n2,n3/app?replicaSet=rs0');\n\n// Sharded cluster via mongos\nawait mongoose.connect('mongodb://mongos1,mongos2/app');\n"})})]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"read-and-write-concerns",children:"Read and Write Concerns"}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:"Consistency and durability controls at connection level"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Interview points"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Defaults inherited from driver"}),"\n",(0,i.jsx)(e.li,{children:"Can be overridden per query"}),"\n",(0,i.jsx)(e.li,{children:"Critical in multi-region setups"}),"\n"]}),"\n",(0,i.jsxs)(o,{children:[(0,i.jsx)("summary",{children:"Examples (Node.js)"}),(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-js",children:"await mongoose.connect(uri, {\n  readConcern: { level: 'majority' }, // local | majority | snapshot\n  writeConcern: { w: 'majority', j: true }, // number | 'majority'\n});\n"})})]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"graceful-shutdown",children:"Graceful Shutdown"}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsx)(e.p,{children:"Cleanly closing connections during process termination"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Interview points"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Prevents in-flight operation loss"}),"\n",(0,i.jsx)(e.li,{children:"Important for containers and serverless"}),"\n",(0,i.jsx)(e.li,{children:"Must await disconnect"}),"\n"]}),"\n",(0,i.jsxs)(o,{children:[(0,i.jsx)("summary",{children:"Examples (Node.js)"}),(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-js",children:"process.on('SIGINT', async () => {\n  await mongoose.disconnect();\n  process.exit(0);\n});\n"})})]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"notes",children:"Notes"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"One process should reuse a single primary connection"}),"\n",(0,i.jsx)(e.li,{children:"Pool sizing directly affects latency"}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"caveats",children:"Caveats"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Over-pooling wastes memory"}),"\n",(0,i.jsx)(e.li,{children:"Multiple connections complicate debugging"}),"\n",(0,i.jsx)(e.li,{children:"Improper shutdown causes connection leaks"}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,c.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(a,{...n})}):a(n)}}}]);