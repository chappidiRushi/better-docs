"use strict";(globalThis.webpackChunkbetter_docs=globalThis.webpackChunkbetter_docs||[]).push([[3352],{1611(e,n,o){o.r(n),o.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>t,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"mongo/mongoose-performance-optimization","title":"Performance and Optimization","description":"-----------------","source":"@site/docs/mongo/Mongoose Performance and Optimization.md","sourceDirName":"mongo","slug":"/mongo/mongoose-performance-optimization","permalink":"/better-docs/docs/mongo/mongoose-performance-optimization","draft":false,"unlisted":false,"editUrl":"https://github.com/chappidirushi/better-docs/tree/main/docs/mongo/Mongoose Performance and Optimization.md","tags":[],"version":"current","sidebarPosition":39,"frontMatter":{"id":"mongoose-performance-optimization","title":"Performance and Optimization","sidebar_position":39},"sidebar":"tutorialSidebar","previous":{"title":"Error Handling","permalink":"/better-docs/docs/mongo/mongoose-error-handling"},"next":{"title":"Security Considerations","permalink":"/better-docs/docs/mongo/mongoose-security-considerations"}}');var s=o(4848),i=o(8453);const t={id:"mongoose-performance-optimization",title:"Performance and Optimization",sidebar_position:39},a=void 0,l={},c=[{value:"1. Lean Queries",id:"1-lean-queries",level:2},{value:"2. Population Performance",id:"2-population-performance",level:2},{value:"3. High-Throughput Patterns",id:"3-high-throughput-patterns",level:2},{value:"4. Memory Usage",id:"4-memory-usage",level:2},{value:"5. Profiling",id:"5-profiling",level:2},{value:"Notes",id:"notes",level:2},{value:"Caveats",id:"caveats",level:2}];function d(e){const n={blockquote:"blockquote",code:"code",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components},{Details:o}=n;return o||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"1-lean-queries",children:"1. Lean Queries"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Skip document hydration for maximum read performance"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"Query.prototype.lean(options?)   // \u2192 Query<Array|Object>\n"})}),"\n",(0,s.jsxs)(o,{children:[(0,s.jsx)("summary",{children:"Examples"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// basic lean\nawait User.find({ active: true })\n  .lean();                        // boolean | object\n\n// lean with options\nawait User.findById(id)\n  .lean({\n    virtuals: false,              // boolean\n    getters: false,               // boolean\n    defaults: false               // boolean\n  });\n"})})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"2-population-performance",children:"2. Population Performance"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Population introduces extra queries and memory overhead"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:".populate(path, select?, options?)\n"})}),"\n",(0,s.jsxs)(o,{children:[(0,s.jsx)("summary",{children:"Examples"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// naive populate\nawait Post.find()\n  .populate('author');            // string | object\n\n// optimized populate\nawait Post.find()\n  .populate({\n    path: 'author',               // string\n    select: 'name email',         // string | object\n    options: { lean: true }       // object\n  });\n\n// manual batching alternative\nconst posts = await Post.find().lean();\nconst users = await User.find({ _id: { $in: posts.map(p => p.author) } }).lean();\n"})})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"3-high-throughput-patterns",children:"3. High-Throughput Patterns"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Patterns for write-heavy or read-heavy systems"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"bulkWrite | insertMany | updateMany\n"})}),"\n",(0,s.jsxs)(o,{children:[(0,s.jsx)("summary",{children:"Examples"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// bulkWrite\nawait User.bulkWrite([\n  { insertOne: { document: { email: 'a@test.com' } } },\n  { updateOne: {\n      filter: { email: 'b@test.com' },\n      update: { $inc: { score: 1 } },\n      upsert: true\n  }}\n], {\n  ordered: false                 // boolean\n});\n\n// insertMany\nawait Log.insertMany(logs, {\n  ordered: false,                // boolean\n  lean: true                     // boolean\n});\n"})})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"4-memory-usage",children:"4. Memory Usage"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Control memory footprint during large operations"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"cursor | batchSize | stream\n"})}),"\n",(0,s.jsxs)(o,{children:[(0,s.jsx)("summary",{children:"Examples"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// cursor iteration\nconst cursor = User.find({}).lean().cursor({\n  batchSize: 500                 // number\n});\n\nfor await (const doc of cursor) {\n  // process doc\n}\n\n// limit document size\nawait User.find({}, 'email name') // projection\n  .lean();\n"})})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"5-profiling",children:"5. Profiling"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Identify slow queries and bottlenecks"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"explain | mongoose.set('debug')\n"})}),"\n",(0,s.jsxs)(o,{children:[(0,s.jsx)("summary",{children:"Examples"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// explain plan\nawait User.find({ email })\n  .explain('executionStats');     // 'queryPlanner' | 'executionStats'\n\n// mongoose debug\nmongoose.set('debug', function (coll, method, query, doc) {\n  console.log(coll, method, query);\n});\n\n// MongoDB profiler (shell)\ndb.setProfilingLevel(1, { slowms: 50 });\n"})})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Lean queries can be 2\u20135x faster"}),"\n",(0,s.jsx)(n.li,{children:"Population scales poorly with large datasets"}),"\n",(0,s.jsx)(n.li,{children:"Bulk operations reduce network round-trips"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"caveats",children:"Caveats"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Lean queries bypass middleware and virtuals"}),"\n",(0,s.jsx)(n.li,{children:"Overusing population leads to N+1 problems"}),"\n",(0,s.jsx)(n.li,{children:"Profiling in production must be time-boxed"}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453(e,n,o){o.d(n,{R:()=>t,x:()=>a});var r=o(6540);const s={},i=r.createContext(s);function t(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);