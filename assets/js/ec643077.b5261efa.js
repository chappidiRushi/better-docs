"use strict";(globalThis.webpackChunkbetter_docs=globalThis.webpackChunkbetter_docs||[]).push([[4186],{8453(e,n,i){i.d(n,{R:()=>o,x:()=>t});var s=i(6540);const r={},l=s.createContext(r);function o(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(l.Provider,{value:n},e.children)}},9992(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"mongo/mongodb-replication","title":"Replication","description":"-----------------","source":"@site/docs/mongo/Replication.md","sourceDirName":"mongo","slug":"/mongo/mongodb-replication","permalink":"/better-docs/docs/mongo/mongodb-replication","draft":false,"unlisted":false,"editUrl":"https://github.com/chappidirushi/better-docs/tree/main/docs/mongo/Replication.md","tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"id":"mongodb-replication","title":"Replication","sidebar_position":10},"sidebar":"tutorialSidebar","previous":{"title":"Transactions and Consistency","permalink":"/better-docs/docs/mongo/mongodb-transactions-consistency"},"next":{"title":"Sharding","permalink":"/better-docs/docs/mongo/mongodb-sharding"}}');var r=i(4848),l=i(8453);const o={id:"mongodb-replication",title:"Replication",sidebar_position:10},t=void 0,c={},a=[{value:"Replica Set Architecture",id:"replica-set-architecture",level:2},{value:"Oplog Internals",id:"oplog-internals",level:2},{value:"Write Concerns",id:"write-concerns",level:2},{value:"Read Concerns",id:"read-concerns",level:2},{value:"Read Preferences",id:"read-preferences",level:2},{value:"Failover and Elections",id:"failover-and-elections",level:2},{value:"Replication Lag and Rollbacks",id:"replication-lag-and-rollbacks",level:2},{value:"Notes",id:"notes",level:2},{value:"Caveats",id:"caveats",level:2}];function d(e){const n={blockquote:"blockquote",code:"code",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components},{Details:i}=n;return i||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"replica-set-architecture",children:"Replica Set Architecture"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"A group of mongod instances maintaining the same dataset"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"One primary, multiple secondaries"}),"\n",(0,r.jsx)(n.li,{children:"Automatic failover"}),"\n",(0,r.jsx)(n.li,{children:"Majority-based consensus"}),"\n"]}),"\n",(0,r.jsxs)(i,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Connect to replica set\nconst client = new MongoClient(\n  'mongodb://host1,host2,host3/?replicaSet=rs0'\n);\n\nawait client.connect();\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"oplog-internals",children:"Oplog Internals"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Capped collection recording all write operations"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Ordered, idempotent operations"}),"\n",(0,r.jsx)(n.li,{children:"Secondaries replicate from oplog"}),"\n",(0,r.jsx)(n.li,{children:"Size impacts rollback window"}),"\n"]}),"\n",(0,r.jsxs)(i,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Read oplog (admin only)\nconst oplog = client.db('local').collection('oplog.rs');\n\nawait oplog.find().limit(1).toArray();\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"write-concerns",children:"Write Concerns"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Level of acknowledgment for write operations"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Controls durability"}),"\n",(0,r.jsx)(n.li,{children:"Majority ensures replication"}),"\n",(0,r.jsx)(n.li,{children:"Tradeoff with latency"}),"\n"]}),"\n",(0,r.jsxs)(i,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"await db.collection('users').insertOne(\n  { name: 'A' },\n  {\n    writeConcern: {\n      w: 'majority', // number | 'majority'\n      j: true,       // boolean\n      wtimeout: 5000 // ms\n    }\n  }\n);\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"read-concerns",children:"Read Concerns"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Guarantees about data visibility"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Controls consistency"}),"\n",(0,r.jsx)(n.li,{children:"Snapshot isolation for transactions"}),"\n"]}),"\n",(0,r.jsxs)(i,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"await db.collection('orders').findOne(\n  { _id: 1 },\n  {\n    readConcern: {\n      level: 'majority' // local | available | majority | snapshot\n    }\n  }\n);\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"read-preferences",children:"Read Preferences"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Determines which replica set member handles reads"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Primary preferred for consistency"}),"\n",(0,r.jsx)(n.li,{children:"Secondaries for scaling"}),"\n"]}),"\n",(0,r.jsxs)(i,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"const client = new MongoClient(uri, {\n  readPreference: 'secondaryPreferred' // primary | secondary | nearest\n});\n\nawait client.connect();\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"failover-and-elections",children:"Failover and Elections"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Automatic primary selection on failure"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Raft-like election"}),"\n",(0,r.jsx)(n.li,{children:"Majority vote required"}),"\n",(0,r.jsx)(n.li,{children:"Brief write unavailability"}),"\n"]}),"\n",(0,r.jsxs)(i,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Step down primary (admin)\nawait adminDb.command({ replSetStepDown: 60 });\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"replication-lag-and-rollbacks",children:"Replication Lag and Rollbacks"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Delay and divergence between primary and secondaries"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Lag impacts read freshness"}),"\n",(0,r.jsx)(n.li,{children:"Rollbacks occur on divergent writes"}),"\n"]}),"\n",(0,r.jsxs)(i,{children:[(0,r.jsx)("summary",{children:"Examples (Node.js)"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Check replication status\nawait adminDb.command({ replSetGetStatus: 1 });\n"})})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Majority write + read concern ensures strong consistency"}),"\n",(0,r.jsx)(n.li,{children:"Replication underpins transactions"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"caveats",children:"Caveats"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Network partitions cause elections"}),"\n",(0,r.jsx)(n.li,{children:"Long lag increases rollback risk"}),"\n",(0,r.jsx)(n.li,{children:"Writes briefly unavailable during failover"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);