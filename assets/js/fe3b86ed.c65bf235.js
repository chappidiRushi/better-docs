"use strict";(globalThis.webpackChunkbetter_docs=globalThis.webpackChunkbetter_docs||[]).push([[3462],{8188(e,n,s){s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"mongo/mongoose-population","title":"Mongoose Population System","description":"-----------------","source":"@site/docs/mongo/Mongoose Population.md","sourceDirName":"mongo","slug":"/mongo/mongoose-population","permalink":"/better-docs/docs/mongo/mongoose-population","draft":false,"unlisted":false,"editUrl":"https://github.com/chappidirushi/better-docs/tree/main/docs/mongo/Mongoose Population.md","tags":[],"version":"current","sidebarPosition":31,"frontMatter":{"id":"mongoose-population","title":"Mongoose Population System","sidebar_position":31},"sidebar":"tutorialSidebar","previous":{"title":"Mongoose Middleware (Hooks)","permalink":"/better-docs/docs/mongo/mongoose-middleware"},"next":{"title":"Mongoose Aggregation","permalink":"/better-docs/docs/mongo/mongoose-aggregation"}}');var t=s(4848),r=s(8453);const i={id:"mongoose-population",title:"Mongoose Population System",sidebar_position:31},l=void 0,a={},c=[{value:"Populate Internals",id:"populate-internals",level:2},{value:"Reference Resolution",id:"reference-resolution",level:2},{value:"Virtual Populate",id:"virtual-populate",level:2},{value:"Performance Tradeoffs",id:"performance-tradeoffs",level:2},{value:"Populate vs Aggregation",id:"populate-vs-aggregation",level:2},{value:"Notes",id:"notes",level:2},{value:"Caveats",id:"caveats",level:2}];function d(e){const n={blockquote:"blockquote",code:"code",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"populate-internals",children:"Populate Internals"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"How Mongoose executes population under the hood"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Population is a ",(0,t.jsx)(n.strong,{children:"two-phase query"})]}),"\n",(0,t.jsx)(n.li,{children:"First query fetches base documents"}),"\n",(0,t.jsx)(n.li,{children:"Second query fetches referenced documents"}),"\n",(0,t.jsxs)(n.li,{children:["Join happens ",(0,t.jsx)(n.strong,{children:"in application memory"}),", not MongoDB"]}),"\n"]}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Examples (Node.js)"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// Schema\nconst postSchema = new Schema({\n  author: { type: Schema.Types.ObjectId, ref: 'User' }\n});\n\n// Execution\nconst posts = await Post.find().populate('author');\n\n// Internals (conceptual)\n// 1. find posts\n// 2. collect author ObjectIds\n// 3. find users by _id\n// 4. map users back to posts\n"})})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"reference-resolution",children:"Reference Resolution"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Mapping ObjectId references to actual documents"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Requires ",(0,t.jsx)(n.code,{children:"ref"})," metadata"]}),"\n",(0,t.jsxs)(n.li,{children:["Uses ",(0,t.jsx)(n.code,{children:"_id"})," by default"]}),"\n",(0,t.jsx)(n.li,{children:"Supports custom local/foreign fields"}),"\n"]}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Examples (Node.js)"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// Default resolution\nconst schema = new Schema({\n  user: { type: Schema.Types.ObjectId, ref: 'User' }\n});\n\nawait Order.find().populate('user');\n\n// Custom fields\nawait Order.find().populate({\n  path: 'user',\n  localField: 'userId',\n  foreignField: 'externalId',\n  justOne: true // boolean\n});\n"})})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"virtual-populate",children:"Virtual Populate"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Non-persisted relationships defined via virtual fields"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"No foreign key stored in document"}),"\n",(0,t.jsx)(n.li,{children:"One-to-many and reverse lookups"}),"\n",(0,t.jsxs)(n.li,{children:["Requires ",(0,t.jsx)(n.code,{children:"virtuals: true"})," in schema options"]}),"\n"]}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Examples (Node.js)"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// User schema\nuserSchema.virtual('posts', {\n  ref: 'Post',\n  localField: '_id',\n  foreignField: 'author',\n  justOne: false // array\n});\n\n// Enable virtuals\nuserSchema.set('toObject', { virtuals: true });\nuserSchema.set('toJSON', { virtuals: true });\n\n// Usage\nconst user = await User.findById(id).populate('posts');\n"})})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"performance-tradeoffs",children:"Performance Tradeoffs"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Cost and scalability implications of populate"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Extra queries per populate path"}),"\n",(0,t.jsx)(n.li,{children:"Large fan-out causes memory pressure"}),"\n",(0,t.jsx)(n.li,{children:"Cannot leverage server-side joins"}),"\n"]}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Examples (Node.js)"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// \u274c N+1 risk\nawait Post.find().populate('author comments.user');\n\n// \u274c Large arrays\nawait User.find().populate('orders'); // thousands of docs\n\n// \u2705 Limit fields\nawait Post.find().populate({\n  path: 'author',\n  select: 'email name', // projection\n  options: { lean: true }\n});\n"})})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"populate-vs-aggregation",children:"Populate vs Aggregation"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Choosing between Mongoose populate and MongoDB $lookup"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Interview points"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Populate = app-side join"}),"\n",(0,t.jsx)(n.li,{children:"Aggregation = server-side join"}),"\n",(0,t.jsx)(n.li,{children:"Aggregation scales better for large datasets"}),"\n"]}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Examples (Node.js)"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// Populate\nawait Order.find().populate('customer');\n\n// Aggregation equivalent\nawait Order.aggregate([\n  {\n    $lookup: {\n      from: 'customers',\n      localField: 'customer',\n      foreignField: '_id',\n      as: 'customer'\n    }\n  },\n  { $unwind: '$customer' }\n]);\n"})})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Populate works only through Mongoose"}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"lean()"})," disables document hydration but not population"]}),"\n",(0,t.jsx)(n.li,{children:"Nested populate multiplies query cost"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"caveats",children:"Caveats"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"No transactional guarantees across populated queries"}),"\n",(0,t.jsx)(n.li,{children:"Large populates can exhaust memory"}),"\n",(0,t.jsx)(n.li,{children:"Populate hides query complexity"}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>i,x:()=>l});var o=s(6540);const t={},r=o.createContext(t);function i(e){const n=o.useContext(r);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);